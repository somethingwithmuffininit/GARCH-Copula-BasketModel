\documentclass[11pt]{article}

    \usepackage[breakable]{tcolorbox}
    \usepackage{parskip} % Stop auto-indenting (to mimic markdown behaviour)
    

    % Basic figure setup, for now with no caption control since it's done
    % automatically by Pandoc (which extracts ![](path) syntax from Markdown).
    \usepackage{graphicx}
    % Keep aspect ratio if custom image width or height is specified
    \setkeys{Gin}{keepaspectratio}
    % Maintain compatibility with old templates. Remove in nbconvert 6.0
    \let\Oldincludegraphics\includegraphics
    % Ensure that by default, figures have no caption (until we provide a
    % proper Figure object with a Caption API and a way to capture that
    % in the conversion process - todo).
    \usepackage{caption}
    \DeclareCaptionFormat{nocaption}{}
    \captionsetup{format=nocaption,aboveskip=0pt,belowskip=0pt}

    \usepackage{float}
    \floatplacement{figure}{H} % forces figures to be placed at the correct location
    \usepackage{xcolor} % Allow colors to be defined
    \usepackage{enumerate} % Needed for markdown enumerations to work
    \usepackage{geometry} % Used to adjust the document margins
    \usepackage{amsmath} % Equations
    \usepackage{amssymb} % Equations
    \usepackage{textcomp} % defines textquotesingle
    % Hack from http://tex.stackexchange.com/a/47451/13684:
    \AtBeginDocument{%
        \def\PYZsq{\textquotesingle}% Upright quotes in Pygmentized code
    }
    \usepackage{upquote} % Upright quotes for verbatim code
    \usepackage{eurosym} % defines \euro

    \usepackage{iftex}
    \ifPDFTeX
        \usepackage[T1]{fontenc}
        \IfFileExists{alphabeta.sty}{
              \usepackage{alphabeta}
          }{
              \usepackage[mathletters]{ucs}
              \usepackage[utf8x]{inputenc}
          }
    \else
        \usepackage{fontspec}
        \usepackage{unicode-math}
    \fi

    \usepackage{fancyvrb} % verbatim replacement that allows latex
    \usepackage{grffile} % extends the file name processing of package graphics
                         % to support a larger range
    \makeatletter % fix for old versions of grffile with XeLaTeX
    \@ifpackagelater{grffile}{2019/11/01}
    {
      % Do nothing on new versions
    }
    {
      \def\Gread@@xetex#1{%
        \IfFileExists{"\Gin@base".bb}%
        {\Gread@eps{\Gin@base.bb}}%
        {\Gread@@xetex@aux#1}%
      }
    }
    \makeatother
    \usepackage[Export]{adjustbox} % Used to constrain images to a maximum size
    \adjustboxset{max size={0.9\linewidth}{0.9\paperheight}}

    % The hyperref package gives us a pdf with properly built
    % internal navigation ('pdf bookmarks' for the table of contents,
    % internal cross-reference links, web links for URLs, etc.)
    \usepackage{hyperref}
    % The default LaTeX title has an obnoxious amount of whitespace. By default,
    % titling removes some of it. It also provides customization options.
    \usepackage{titling}
    \usepackage{longtable} % longtable support required by pandoc >1.10
    \usepackage{booktabs}  % table support for pandoc > 1.12.2
    \usepackage{array}     % table support for pandoc >= 2.11.3
    \usepackage{calc}      % table minipage width calculation for pandoc >= 2.11.1
    \usepackage[inline]{enumitem} % IRkernel/repr support (it uses the enumerate* environment)
    \usepackage[normalem]{ulem} % ulem is needed to support strikethroughs (\sout)
                                % normalem makes italics be italics, not underlines
    \usepackage{soul}      % strikethrough (\st) support for pandoc >= 3.0.0
    \usepackage{mathrsfs}
    

    
    % Colors for the hyperref package
    \definecolor{urlcolor}{rgb}{0,.145,.698}
    \definecolor{linkcolor}{rgb}{.71,0.21,0.01}
    \definecolor{citecolor}{rgb}{.12,.54,.11}

    % ANSI colors
    \definecolor{ansi-black}{HTML}{3E424D}
    \definecolor{ansi-black-intense}{HTML}{282C36}
    \definecolor{ansi-red}{HTML}{E75C58}
    \definecolor{ansi-red-intense}{HTML}{B22B31}
    \definecolor{ansi-green}{HTML}{00A250}
    \definecolor{ansi-green-intense}{HTML}{007427}
    \definecolor{ansi-yellow}{HTML}{DDB62B}
    \definecolor{ansi-yellow-intense}{HTML}{B27D12}
    \definecolor{ansi-blue}{HTML}{208FFB}
    \definecolor{ansi-blue-intense}{HTML}{0065CA}
    \definecolor{ansi-magenta}{HTML}{D160C4}
    \definecolor{ansi-magenta-intense}{HTML}{A03196}
    \definecolor{ansi-cyan}{HTML}{60C6C8}
    \definecolor{ansi-cyan-intense}{HTML}{258F8F}
    \definecolor{ansi-white}{HTML}{C5C1B4}
    \definecolor{ansi-white-intense}{HTML}{A1A6B2}
    \definecolor{ansi-default-inverse-fg}{HTML}{FFFFFF}
    \definecolor{ansi-default-inverse-bg}{HTML}{000000}

    % common color for the border for error outputs.
    \definecolor{outerrorbackground}{HTML}{FFDFDF}

    % commands and environments needed by pandoc snippets
    % extracted from the output of `pandoc -s`
    \providecommand{\tightlist}{%
      \setlength{\itemsep}{0pt}\setlength{\parskip}{0pt}}
    \DefineVerbatimEnvironment{Highlighting}{Verbatim}{commandchars=\\\{\}}
    % Add ',fontsize=\small' for more characters per line
    \newenvironment{Shaded}{}{}
    \newcommand{\KeywordTok}[1]{\textcolor[rgb]{0.00,0.44,0.13}{\textbf{{#1}}}}
    \newcommand{\DataTypeTok}[1]{\textcolor[rgb]{0.56,0.13,0.00}{{#1}}}
    \newcommand{\DecValTok}[1]{\textcolor[rgb]{0.25,0.63,0.44}{{#1}}}
    \newcommand{\BaseNTok}[1]{\textcolor[rgb]{0.25,0.63,0.44}{{#1}}}
    \newcommand{\FloatTok}[1]{\textcolor[rgb]{0.25,0.63,0.44}{{#1}}}
    \newcommand{\CharTok}[1]{\textcolor[rgb]{0.25,0.44,0.63}{{#1}}}
    \newcommand{\StringTok}[1]{\textcolor[rgb]{0.25,0.44,0.63}{{#1}}}
    \newcommand{\CommentTok}[1]{\textcolor[rgb]{0.38,0.63,0.69}{\textit{{#1}}}}
    \newcommand{\OtherTok}[1]{\textcolor[rgb]{0.00,0.44,0.13}{{#1}}}
    \newcommand{\AlertTok}[1]{\textcolor[rgb]{1.00,0.00,0.00}{\textbf{{#1}}}}
    \newcommand{\FunctionTok}[1]{\textcolor[rgb]{0.02,0.16,0.49}{{#1}}}
    \newcommand{\RegionMarkerTok}[1]{{#1}}
    \newcommand{\ErrorTok}[1]{\textcolor[rgb]{1.00,0.00,0.00}{\textbf{{#1}}}}
    \newcommand{\NormalTok}[1]{{#1}}

    % Additional commands for more recent versions of Pandoc
    \newcommand{\ConstantTok}[1]{\textcolor[rgb]{0.53,0.00,0.00}{{#1}}}
    \newcommand{\SpecialCharTok}[1]{\textcolor[rgb]{0.25,0.44,0.63}{{#1}}}
    \newcommand{\VerbatimStringTok}[1]{\textcolor[rgb]{0.25,0.44,0.63}{{#1}}}
    \newcommand{\SpecialStringTok}[1]{\textcolor[rgb]{0.73,0.40,0.53}{{#1}}}
    \newcommand{\ImportTok}[1]{{#1}}
    \newcommand{\DocumentationTok}[1]{\textcolor[rgb]{0.73,0.13,0.13}{\textit{{#1}}}}
    \newcommand{\AnnotationTok}[1]{\textcolor[rgb]{0.38,0.63,0.69}{\textbf{\textit{{#1}}}}}
    \newcommand{\CommentVarTok}[1]{\textcolor[rgb]{0.38,0.63,0.69}{\textbf{\textit{{#1}}}}}
    \newcommand{\VariableTok}[1]{\textcolor[rgb]{0.10,0.09,0.49}{{#1}}}
    \newcommand{\ControlFlowTok}[1]{\textcolor[rgb]{0.00,0.44,0.13}{\textbf{{#1}}}}
    \newcommand{\OperatorTok}[1]{\textcolor[rgb]{0.40,0.40,0.40}{{#1}}}
    \newcommand{\BuiltInTok}[1]{{#1}}
    \newcommand{\ExtensionTok}[1]{{#1}}
    \newcommand{\PreprocessorTok}[1]{\textcolor[rgb]{0.74,0.48,0.00}{{#1}}}
    \newcommand{\AttributeTok}[1]{\textcolor[rgb]{0.49,0.56,0.16}{{#1}}}
    \newcommand{\InformationTok}[1]{\textcolor[rgb]{0.38,0.63,0.69}{\textbf{\textit{{#1}}}}}
    \newcommand{\WarningTok}[1]{\textcolor[rgb]{0.38,0.63,0.69}{\textbf{\textit{{#1}}}}}


    % Define a nice break command that doesn't care if a line doesn't already
    % exist.
    \def\br{\hspace*{\fill} \\* }
    % Math Jax compatibility definitions
    \def\gt{>}
    \def\lt{<}
    \let\Oldtex\TeX
    \let\Oldlatex\LaTeX
    \renewcommand{\TeX}{\textrm{\Oldtex}}
    \renewcommand{\LaTeX}{\textrm{\Oldlatex}}
    % Document parameters
    % Document title
    \title{Pricing Index Basket Options- A Copula Based Approach}
    \author{Liam McKelvey}
    
    
    
    
    
    
% Pygments definitions
\makeatletter
\def\PY@reset{\let\PY@it=\relax \let\PY@bf=\relax%
    \let\PY@ul=\relax \let\PY@tc=\relax%
    \let\PY@bc=\relax \let\PY@ff=\relax}
\def\PY@tok#1{\csname PY@tok@#1\endcsname}
\def\PY@toks#1+{\ifx\relax#1\empty\else%
    \PY@tok{#1}\expandafter\PY@toks\fi}
\def\PY@do#1{\PY@bc{\PY@tc{\PY@ul{%
    \PY@it{\PY@bf{\PY@ff{#1}}}}}}}
\def\PY#1#2{\PY@reset\PY@toks#1+\relax+\PY@do{#2}}

\@namedef{PY@tok@w}{\def\PY@tc##1{\textcolor[rgb]{0.73,0.73,0.73}{##1}}}
\@namedef{PY@tok@c}{\let\PY@it=\textit\def\PY@tc##1{\textcolor[rgb]{0.24,0.48,0.48}{##1}}}
\@namedef{PY@tok@cp}{\def\PY@tc##1{\textcolor[rgb]{0.61,0.40,0.00}{##1}}}
\@namedef{PY@tok@k}{\let\PY@bf=\textbf\def\PY@tc##1{\textcolor[rgb]{0.00,0.50,0.00}{##1}}}
\@namedef{PY@tok@kp}{\def\PY@tc##1{\textcolor[rgb]{0.00,0.50,0.00}{##1}}}
\@namedef{PY@tok@kt}{\def\PY@tc##1{\textcolor[rgb]{0.69,0.00,0.25}{##1}}}
\@namedef{PY@tok@o}{\def\PY@tc##1{\textcolor[rgb]{0.40,0.40,0.40}{##1}}}
\@namedef{PY@tok@ow}{\let\PY@bf=\textbf\def\PY@tc##1{\textcolor[rgb]{0.67,0.13,1.00}{##1}}}
\@namedef{PY@tok@nb}{\def\PY@tc##1{\textcolor[rgb]{0.00,0.50,0.00}{##1}}}
\@namedef{PY@tok@nf}{\def\PY@tc##1{\textcolor[rgb]{0.00,0.00,1.00}{##1}}}
\@namedef{PY@tok@nc}{\let\PY@bf=\textbf\def\PY@tc##1{\textcolor[rgb]{0.00,0.00,1.00}{##1}}}
\@namedef{PY@tok@nn}{\let\PY@bf=\textbf\def\PY@tc##1{\textcolor[rgb]{0.00,0.00,1.00}{##1}}}
\@namedef{PY@tok@ne}{\let\PY@bf=\textbf\def\PY@tc##1{\textcolor[rgb]{0.80,0.25,0.22}{##1}}}
\@namedef{PY@tok@nv}{\def\PY@tc##1{\textcolor[rgb]{0.10,0.09,0.49}{##1}}}
\@namedef{PY@tok@no}{\def\PY@tc##1{\textcolor[rgb]{0.53,0.00,0.00}{##1}}}
\@namedef{PY@tok@nl}{\def\PY@tc##1{\textcolor[rgb]{0.46,0.46,0.00}{##1}}}
\@namedef{PY@tok@ni}{\let\PY@bf=\textbf\def\PY@tc##1{\textcolor[rgb]{0.44,0.44,0.44}{##1}}}
\@namedef{PY@tok@na}{\def\PY@tc##1{\textcolor[rgb]{0.41,0.47,0.13}{##1}}}
\@namedef{PY@tok@nt}{\let\PY@bf=\textbf\def\PY@tc##1{\textcolor[rgb]{0.00,0.50,0.00}{##1}}}
\@namedef{PY@tok@nd}{\def\PY@tc##1{\textcolor[rgb]{0.67,0.13,1.00}{##1}}}
\@namedef{PY@tok@s}{\def\PY@tc##1{\textcolor[rgb]{0.73,0.13,0.13}{##1}}}
\@namedef{PY@tok@sd}{\let\PY@it=\textit\def\PY@tc##1{\textcolor[rgb]{0.73,0.13,0.13}{##1}}}
\@namedef{PY@tok@si}{\let\PY@bf=\textbf\def\PY@tc##1{\textcolor[rgb]{0.64,0.35,0.47}{##1}}}
\@namedef{PY@tok@se}{\let\PY@bf=\textbf\def\PY@tc##1{\textcolor[rgb]{0.67,0.36,0.12}{##1}}}
\@namedef{PY@tok@sr}{\def\PY@tc##1{\textcolor[rgb]{0.64,0.35,0.47}{##1}}}
\@namedef{PY@tok@ss}{\def\PY@tc##1{\textcolor[rgb]{0.10,0.09,0.49}{##1}}}
\@namedef{PY@tok@sx}{\def\PY@tc##1{\textcolor[rgb]{0.00,0.50,0.00}{##1}}}
\@namedef{PY@tok@m}{\def\PY@tc##1{\textcolor[rgb]{0.40,0.40,0.40}{##1}}}
\@namedef{PY@tok@gh}{\let\PY@bf=\textbf\def\PY@tc##1{\textcolor[rgb]{0.00,0.00,0.50}{##1}}}
\@namedef{PY@tok@gu}{\let\PY@bf=\textbf\def\PY@tc##1{\textcolor[rgb]{0.50,0.00,0.50}{##1}}}
\@namedef{PY@tok@gd}{\def\PY@tc##1{\textcolor[rgb]{0.63,0.00,0.00}{##1}}}
\@namedef{PY@tok@gi}{\def\PY@tc##1{\textcolor[rgb]{0.00,0.52,0.00}{##1}}}
\@namedef{PY@tok@gr}{\def\PY@tc##1{\textcolor[rgb]{0.89,0.00,0.00}{##1}}}
\@namedef{PY@tok@ge}{\let\PY@it=\textit}
\@namedef{PY@tok@gs}{\let\PY@bf=\textbf}
\@namedef{PY@tok@ges}{\let\PY@bf=\textbf\let\PY@it=\textit}
\@namedef{PY@tok@gp}{\let\PY@bf=\textbf\def\PY@tc##1{\textcolor[rgb]{0.00,0.00,0.50}{##1}}}
\@namedef{PY@tok@go}{\def\PY@tc##1{\textcolor[rgb]{0.44,0.44,0.44}{##1}}}
\@namedef{PY@tok@gt}{\def\PY@tc##1{\textcolor[rgb]{0.00,0.27,0.87}{##1}}}
\@namedef{PY@tok@err}{\def\PY@bc##1{{\setlength{\fboxsep}{\string -\fboxrule}\fcolorbox[rgb]{1.00,0.00,0.00}{1,1,1}{\strut ##1}}}}
\@namedef{PY@tok@kc}{\let\PY@bf=\textbf\def\PY@tc##1{\textcolor[rgb]{0.00,0.50,0.00}{##1}}}
\@namedef{PY@tok@kd}{\let\PY@bf=\textbf\def\PY@tc##1{\textcolor[rgb]{0.00,0.50,0.00}{##1}}}
\@namedef{PY@tok@kn}{\let\PY@bf=\textbf\def\PY@tc##1{\textcolor[rgb]{0.00,0.50,0.00}{##1}}}
\@namedef{PY@tok@kr}{\let\PY@bf=\textbf\def\PY@tc##1{\textcolor[rgb]{0.00,0.50,0.00}{##1}}}
\@namedef{PY@tok@bp}{\def\PY@tc##1{\textcolor[rgb]{0.00,0.50,0.00}{##1}}}
\@namedef{PY@tok@fm}{\def\PY@tc##1{\textcolor[rgb]{0.00,0.00,1.00}{##1}}}
\@namedef{PY@tok@vc}{\def\PY@tc##1{\textcolor[rgb]{0.10,0.09,0.49}{##1}}}
\@namedef{PY@tok@vg}{\def\PY@tc##1{\textcolor[rgb]{0.10,0.09,0.49}{##1}}}
\@namedef{PY@tok@vi}{\def\PY@tc##1{\textcolor[rgb]{0.10,0.09,0.49}{##1}}}
\@namedef{PY@tok@vm}{\def\PY@tc##1{\textcolor[rgb]{0.10,0.09,0.49}{##1}}}
\@namedef{PY@tok@sa}{\def\PY@tc##1{\textcolor[rgb]{0.73,0.13,0.13}{##1}}}
\@namedef{PY@tok@sb}{\def\PY@tc##1{\textcolor[rgb]{0.73,0.13,0.13}{##1}}}
\@namedef{PY@tok@sc}{\def\PY@tc##1{\textcolor[rgb]{0.73,0.13,0.13}{##1}}}
\@namedef{PY@tok@dl}{\def\PY@tc##1{\textcolor[rgb]{0.73,0.13,0.13}{##1}}}
\@namedef{PY@tok@s2}{\def\PY@tc##1{\textcolor[rgb]{0.73,0.13,0.13}{##1}}}
\@namedef{PY@tok@sh}{\def\PY@tc##1{\textcolor[rgb]{0.73,0.13,0.13}{##1}}}
\@namedef{PY@tok@s1}{\def\PY@tc##1{\textcolor[rgb]{0.73,0.13,0.13}{##1}}}
\@namedef{PY@tok@mb}{\def\PY@tc##1{\textcolor[rgb]{0.40,0.40,0.40}{##1}}}
\@namedef{PY@tok@mf}{\def\PY@tc##1{\textcolor[rgb]{0.40,0.40,0.40}{##1}}}
\@namedef{PY@tok@mh}{\def\PY@tc##1{\textcolor[rgb]{0.40,0.40,0.40}{##1}}}
\@namedef{PY@tok@mi}{\def\PY@tc##1{\textcolor[rgb]{0.40,0.40,0.40}{##1}}}
\@namedef{PY@tok@il}{\def\PY@tc##1{\textcolor[rgb]{0.40,0.40,0.40}{##1}}}
\@namedef{PY@tok@mo}{\def\PY@tc##1{\textcolor[rgb]{0.40,0.40,0.40}{##1}}}
\@namedef{PY@tok@ch}{\let\PY@it=\textit\def\PY@tc##1{\textcolor[rgb]{0.24,0.48,0.48}{##1}}}
\@namedef{PY@tok@cm}{\let\PY@it=\textit\def\PY@tc##1{\textcolor[rgb]{0.24,0.48,0.48}{##1}}}
\@namedef{PY@tok@cpf}{\let\PY@it=\textit\def\PY@tc##1{\textcolor[rgb]{0.24,0.48,0.48}{##1}}}
\@namedef{PY@tok@c1}{\let\PY@it=\textit\def\PY@tc##1{\textcolor[rgb]{0.24,0.48,0.48}{##1}}}
\@namedef{PY@tok@cs}{\let\PY@it=\textit\def\PY@tc##1{\textcolor[rgb]{0.24,0.48,0.48}{##1}}}

\def\PYZbs{\char`\\}
\def\PYZus{\char`\_}
\def\PYZob{\char`\{}
\def\PYZcb{\char`\}}
\def\PYZca{\char`\^}
\def\PYZam{\char`\&}
\def\PYZlt{\char`\<}
\def\PYZgt{\char`\>}
\def\PYZsh{\char`\#}
\def\PYZpc{\char`\%}
\def\PYZdl{\char`\$}
\def\PYZhy{\char`\-}
\def\PYZsq{\char`\'}
\def\PYZdq{\char`\"}
\def\PYZti{\char`\~}
% for compatibility with earlier versions
\def\PYZat{@}
\def\PYZlb{[}
\def\PYZrb{]}
\makeatother


    % For linebreaks inside Verbatim environment from package fancyvrb.
    \makeatletter
        \newbox\Wrappedcontinuationbox
        \newbox\Wrappedvisiblespacebox
        \newcommand*\Wrappedvisiblespace {\textcolor{red}{\textvisiblespace}}
        \newcommand*\Wrappedcontinuationsymbol {\textcolor{red}{\llap{\tiny$\m@th\hookrightarrow$}}}
        \newcommand*\Wrappedcontinuationindent {3ex }
        \newcommand*\Wrappedafterbreak {\kern\Wrappedcontinuationindent\copy\Wrappedcontinuationbox}
        % Take advantage of the already applied Pygments mark-up to insert
        % potential linebreaks for TeX processing.
        %        {, <, #, %, $, ' and ": go to next line.
        %        _, }, ^, &, >, - and ~: stay at end of broken line.
        % Use of \textquotesingle for straight quote.
        \newcommand*\Wrappedbreaksatspecials {%
            \def\PYGZus{\discretionary{\char`\_}{\Wrappedafterbreak}{\char`\_}}%
            \def\PYGZob{\discretionary{}{\Wrappedafterbreak\char`\{}{\char`\{}}%
            \def\PYGZcb{\discretionary{\char`\}}{\Wrappedafterbreak}{\char`\}}}%
            \def\PYGZca{\discretionary{\char`\^}{\Wrappedafterbreak}{\char`\^}}%
            \def\PYGZam{\discretionary{\char`\&}{\Wrappedafterbreak}{\char`\&}}%
            \def\PYGZlt{\discretionary{}{\Wrappedafterbreak\char`\<}{\char`\<}}%
            \def\PYGZgt{\discretionary{\char`\>}{\Wrappedafterbreak}{\char`\>}}%
            \def\PYGZsh{\discretionary{}{\Wrappedafterbreak\char`\#}{\char`\#}}%
            \def\PYGZpc{\discretionary{}{\Wrappedafterbreak\char`\%}{\char`\%}}%
            \def\PYGZdl{\discretionary{}{\Wrappedafterbreak\char`\$}{\char`\$}}%
            \def\PYGZhy{\discretionary{\char`\-}{\Wrappedafterbreak}{\char`\-}}%
            \def\PYGZsq{\discretionary{}{\Wrappedafterbreak\textquotesingle}{\textquotesingle}}%
            \def\PYGZdq{\discretionary{}{\Wrappedafterbreak\char`\"}{\char`\"}}%
            \def\PYGZti{\discretionary{\char`\~}{\Wrappedafterbreak}{\char`\~}}%
        }
        % Some characters . , ; ? ! / are not pygmentized.
        % This macro makes them "active" and they will insert potential linebreaks
        \newcommand*\Wrappedbreaksatpunct {%
            \lccode`\~`\.\lowercase{\def~}{\discretionary{\hbox{\char`\.}}{\Wrappedafterbreak}{\hbox{\char`\.}}}%
            \lccode`\~`\,\lowercase{\def~}{\discretionary{\hbox{\char`\,}}{\Wrappedafterbreak}{\hbox{\char`\,}}}%
            \lccode`\~`\;\lowercase{\def~}{\discretionary{\hbox{\char`\;}}{\Wrappedafterbreak}{\hbox{\char`\;}}}%
            \lccode`\~`\:\lowercase{\def~}{\discretionary{\hbox{\char`\:}}{\Wrappedafterbreak}{\hbox{\char`\:}}}%
            \lccode`\~`\?\lowercase{\def~}{\discretionary{\hbox{\char`\?}}{\Wrappedafterbreak}{\hbox{\char`\?}}}%
            \lccode`\~`\!\lowercase{\def~}{\discretionary{\hbox{\char`\!}}{\Wrappedafterbreak}{\hbox{\char`\!}}}%
            \lccode`\~`\/\lowercase{\def~}{\discretionary{\hbox{\char`\/}}{\Wrappedafterbreak}{\hbox{\char`\/}}}%
            \catcode`\.\active
            \catcode`\,\active
            \catcode`\;\active
            \catcode`\:\active
            \catcode`\?\active
            \catcode`\!\active
            \catcode`\/\active
            \lccode`\~`\~
        }
    \makeatother

    \let\OriginalVerbatim=\Verbatim
    \makeatletter
    \renewcommand{\Verbatim}[1][1]{%
        %\parskip\z@skip
        \sbox\Wrappedcontinuationbox {\Wrappedcontinuationsymbol}%
        \sbox\Wrappedvisiblespacebox {\FV@SetupFont\Wrappedvisiblespace}%
        \def\FancyVerbFormatLine ##1{\hsize\linewidth
            \vtop{\raggedright\hyphenpenalty\z@\exhyphenpenalty\z@
                \doublehyphendemerits\z@\finalhyphendemerits\z@
                \strut ##1\strut}%
        }%
        % If the linebreak is at a space, the latter will be displayed as visible
        % space at end of first line, and a continuation symbol starts next line.
        % Stretch/shrink are however usually zero for typewriter font.
        \def\FV@Space {%
            \nobreak\hskip\z@ plus\fontdimen3\font minus\fontdimen4\font
            \discretionary{\copy\Wrappedvisiblespacebox}{\Wrappedafterbreak}
            {\kern\fontdimen2\font}%
        }%

        % Allow breaks at special characters using \PYG... macros.
        \Wrappedbreaksatspecials
        % Breaks at punctuation characters . , ; ? ! and / need catcode=\active
        \OriginalVerbatim[#1,codes*=\Wrappedbreaksatpunct]%
    }
    \makeatother

    % Exact colors from NB
    \definecolor{incolor}{HTML}{303F9F}
    \definecolor{outcolor}{HTML}{D84315}
    \definecolor{cellborder}{HTML}{CFCFCF}
    \definecolor{cellbackground}{HTML}{F7F7F7}

    % prompt
    \makeatletter
    \newcommand{\boxspacing}{\kern\kvtcb@left@rule\kern\kvtcb@boxsep}
    \makeatother
    \newcommand{\prompt}[4]{
        {\ttfamily\llap{{\color{#2}[#3]:\hspace{3pt}#4}}\vspace{-\baselineskip}}
    }
    

    
    % Prevent overflowing lines due to hard-to-break entities
    \sloppy
    % Setup hyperref package
    \hypersetup{
      breaklinks=true,  % so long urls are correctly broken across lines
      colorlinks=true,
      urlcolor=urlcolor,
      linkcolor=linkcolor,
      citecolor=citecolor,
      }
    % Slightly bigger margins than the latex defaults
    
    \geometry{verbose,tmargin=1in,bmargin=1in,lmargin=1in,rmargin=1in}
    
    

\begin{document}
    
    \maketitle
    
    

    
    \section{Introduction}\label{introduction}

In this paper we will be pricing index basket options, using a
combination of time-series forecasts and copula based simulation
methods. Specifically, we will be pricing basket options on the DAX,
AEX, FTSE 100 Nikkei 225, S\&P 500, S\&P/TSX indices, with a payoff
function \(\max{(\text{average return of indices}-k, 0)}\), for various
strikes \(k\), with a time to maturity of one month.

To do this, we will first fit several GARCH based volatility forecasts
to each index, assuming normal, Student's-t, and skewed Student's-t
residuals. Then, we will fit a multivariate-t distribution to our data,
apply the probability transform to our residuals, and fit a Student's-t
copula to the result. Goodness of fit tests will be conducted for each
model. For each assumed residual distribution, we will use Monte Carlo
methods to forecast the payoff of our basket option. We will conclude by
simulating the performance of the covered call strategy, and backtesting
our results.

    \subsection{Background Concepts}\label{background-concepts}

    We assume that the reader has a basic understanding of time-series
models, model fitting, and options. First, let us define our time-series
models.

\subsubsection{ARCH Model}\label{arch-model}

Let us do a brief overview of the Autoregressive Conditional
Heteroskedasticity (ARCH) model. Let \(\{y_t\}\) be a time-series. Let
\(\{\epsilon_t\}\) denote the error terms (known as residuals, with
respect to a mean process). We will assume for each time-series that the
mean process is constant. We assume that \(\epsilon _t = \sigma_t z_t\),
where \(\sigma_t\) repsents the time-dependent volatility/standard
deviation, and \(z_t\) is a white noise process (a stochastic process
with mean 0, constant volatility, and no autocorrelation). We will
assume that our white noise processes have a constantly volatility of 1.

We forecast conditional volatility as:
\[\sigma^2_t = \alpha_0 + \sum_{i=1}^{q} {\alpha_i \epsilon^2_{t-i}}\]

for some \(\alpha_0 > 0, \alpha_i \geq 0\) where q represents the order
of the ARCH process (i.e.~the number of previous residuals to consider).

The main feature of this model is that it is able to capture volatility
clustering in the data, by considering past ``shocks'' or errors.

\subsubsection{GARCH Model}\label{garch-model}

The above can be generalized, by also including an moving average of the
previous volatilities. This results in a Generalized Autoregressive
Conditional Heteroskedasticity (GARCH) model.

We forecast conditional volatility as:
\[\sigma^2_t = \omega + \sum_{i=1}^{q} {\alpha_i \epsilon^2_{t-i}}+\sum_{i=1}^{p} {\beta_i \sigma^2_{t-i}} \]
for some \(\omega > 0, \alpha_i \geq 0, \beta_i \geq 0\) where q
represents the order of the ARCH process, and p represents the order of
the GARCH process (i.e.~the number of previous volatilities to
consider).

This model has the added capability of capturing the persistence of
previous volatility.

For an intuitive understanding of the parameters, consider the yield of
US Government bonds. Note that in the bond market, there are few market
moving events, apart from the occasional interest rate change. The
response to each interest rate change is generally small, as the effect
has been priced in, yielding low values of \(\alpha_i\). However, once
volatility increases, it tends to be persistant, yielding high values of
\(\beta_i\). For empirical justification of this situation, see the
fitted parameters \hyperref[fit-garch-models]{here}.

\paragraph{Noise Processes}\label{noise-processes}

We will assume that our noise process follows one of the following:\\
1. A Standard Normal distribution \(N(0,1)\),\\
2. A Standard Student's-t distribution with a fitted degrees of freedom
\(t_\nu (0,1)\),\\
3. A Skewed Student's-t distribution with fitted degrees of freedom and
skew parameter\\
We assume that the reader is familiar with the first two distributions,
and thus we will only highlight the latter distribution.

\paragraph{Skewed Student's-t
distribution}\label{skewed-students-t-distribution}

We use the density function given by Hansen in
\hyperref[references]{[4]}, and refer the reader there for a more
indepth analysis:

\[g(z|\eta, \lambda) =
\begin{cases}
    bc \left(1 + \frac{1}{\eta - 2} \right) \left( \frac{bz + a}{1 + \lambda} \right)^{-(\eta + 1)/2} & \text{if } z < -a/b, \\
    bc \left(1 + \frac{1}{\eta - 2} \right) \left( \frac{bz + a}{1 + \lambda} \right)^{-(\eta + 1)/2} & \text{if } z \geq -a/b,
\end{cases}\]

where \(2 < \eta < \infty\) and \(-1 < \lambda < 1\), and \$ a = 4
\lambda c \left( \frac{\eta - 2}{\eta - 1} \right) \$,
\(b^2 = 1 + 3A \lambda ^2 - a^2\),
\(c = \frac{\Gamma\left( \frac{\eta + 1}{2} \right)}{\sqrt{\pi (\eta - 2)}} \left( \frac{\eta}{2} \right)\)

The idea behind this distribution is to generalize the Student's-t
distribution, to allow for skewness. Fortunately, the arch library, from
\hyperref[references]{[9]}, allows us to easily sample from this skewed
Student's-t distribution.

    \subsection{Preliminary Work}\label{preliminary-work}

    \subsubsection{Import Libraries}\label{import-libraries}

We will use:\\
1. The yfinance library from \hyperref[references]{[1]} to download our
data,\\
2. the tabulate library from \hyperref[references]{[2]} for printing,\\
3. the numpy library from \hyperref[references]{[5]},\\
4. the matplotlib library from \hyperref[references]{[6]} for data
visualization,\\
5. the pandas library from \hyperref[references]{[7]} for data
structures, 6. the statsmodels library from \hyperref[references]{[8]}
for graphing autocorrelation functions and fitting t-copulas,\\
7. the arch library from \hyperref[references]{[9]} for fitting GARCH
models, and conducting goodness of fit tests,\\
8. the scipy library from \hyperref[references]{[10]} for fitting
multivariate models, conducting simulations, goodness of fit and
hypothesis testing

    \begin{tcolorbox}[breakable, size=fbox, boxrule=1pt, pad at break*=1mm,colback=cellbackground, colframe=cellborder]
\prompt{In}{incolor}{1}{\boxspacing}
\begin{Verbatim}[commandchars=\\\{\}]
\PY{k+kn}{import} \PY{n+nn}{yfinance} \PY{k}{as} \PY{n+nn}{yf}
\PY{k+kn}{import} \PY{n+nn}{tabulate} \PY{k}{as} \PY{n+nn}{tab}
\PY{k+kn}{import} \PY{n+nn}{numpy} \PY{k}{as} \PY{n+nn}{np}
\PY{k+kn}{import} \PY{n+nn}{matplotlib}\PY{n+nn}{.}\PY{n+nn}{pyplot} \PY{k}{as} \PY{n+nn}{plt}
\PY{k+kn}{import} \PY{n+nn}{pandas} \PY{k}{as} \PY{n+nn}{pd}
\PY{k+kn}{from} \PY{n+nn}{statsmodels}\PY{n+nn}{.}\PY{n+nn}{distributions}\PY{n+nn}{.}\PY{n+nn}{copula}\PY{n+nn}{.}\PY{n+nn}{api} \PY{k+kn}{import} \PY{n}{StudentTCopula}
\PY{k+kn}{from} \PY{n+nn}{statsmodels}\PY{n+nn}{.}\PY{n+nn}{graphics}\PY{n+nn}{.}\PY{n+nn}{tsaplots} \PY{k+kn}{import} \PY{n}{plot\PYZus{}acf}
\PY{k+kn}{from} \PY{n+nn}{arch} \PY{k+kn}{import} \PY{n}{arch\PYZus{}model}
\PY{k+kn}{from} \PY{n+nn}{arch}\PY{n+nn}{.}\PY{n+nn}{univariate} \PY{k+kn}{import} \PY{n}{SkewStudent}
\PY{k+kn}{from} \PY{n+nn}{scipy}\PY{n+nn}{.}\PY{n+nn}{stats} \PY{k+kn}{import} \PY{n}{norm}\PY{p}{,} \PY{n}{t}
\PY{k+kn}{from} \PY{n+nn}{scipy}\PY{n+nn}{.}\PY{n+nn}{optimize} \PY{k+kn}{import} \PY{n}{minimize}
\PY{k+kn}{from} \PY{n+nn}{scipy}\PY{n+nn}{.}\PY{n+nn}{stats} \PY{k+kn}{import} \PY{n}{ttest\PYZus{}ind}
\end{Verbatim}
\end{tcolorbox}

    \subsubsection{Import Data}\label{import-data}

This cell imports index data from Yahoo Finance, using the yFinance
library

    \begin{tcolorbox}[breakable, size=fbox, boxrule=1pt, pad at break*=1mm,colback=cellbackground, colframe=cellborder]
\prompt{In}{incolor}{19}{\boxspacing}
\begin{Verbatim}[commandchars=\\\{\}]
\PY{c+c1}{\PYZsh{} List of ticker symbols for each index}
\PY{n}{all\PYZus{}tickers} \PY{o}{=} \PY{p}{[}\PY{l+s+s2}{\PYZdq{}}\PY{l+s+s2}{\PYZca{}GDAXI}\PY{l+s+s2}{\PYZdq{}}\PY{p}{,} \PY{l+s+s2}{\PYZdq{}}\PY{l+s+s2}{\PYZca{}AEX}\PY{l+s+s2}{\PYZdq{}}\PY{p}{,} \PY{l+s+s2}{\PYZdq{}}\PY{l+s+s2}{\PYZca{}FTSE}\PY{l+s+s2}{\PYZdq{}}\PY{p}{,} \PY{l+s+s2}{\PYZdq{}}\PY{l+s+s2}{\PYZca{}N225}\PY{l+s+s2}{\PYZdq{}}\PY{p}{,} \PY{l+s+s2}{\PYZdq{}}\PY{l+s+s2}{\PYZca{}GSPC}\PY{l+s+s2}{\PYZdq{}}\PY{p}{,} \PY{l+s+s2}{\PYZdq{}}\PY{l+s+s2}{\PYZca{}GSPTSE}\PY{l+s+s2}{\PYZdq{}}\PY{p}{,} \PY{l+s+s2}{\PYZdq{}}\PY{l+s+s2}{\PYZca{}TYX}\PY{l+s+s2}{\PYZdq{}}\PY{p}{]}   \PY{c+c1}{\PYZsh{} DAX, AEX, FTSE 100, Nikkei 225, S\PYZam{}P 500, S\PYZam{}P/TSX Composite, US Treasury Yield}
\PY{n}{index\PYZus{}datasets} \PY{o}{=} \PY{p}{\PYZob{}}\PY{p}{\PYZcb{}}
\PY{c+c1}{\PYZsh{} Loop over each ticker symbol to fetch the data}
\PY{k}{for} \PY{n}{ticker} \PY{o+ow}{in} \PY{n}{all\PYZus{}tickers}\PY{p}{:}
    \PY{c+c1}{\PYZsh{} Retrieve the historical data starting from November 20, 1992}
    \PY{n}{index} \PY{o}{=} \PY{n}{yf}\PY{o}{.}\PY{n}{Ticker}\PY{p}{(}\PY{n}{ticker}\PY{p}{)}
    \PY{c+c1}{\PYZsh{}Save to dictionary}
    \PY{n}{index\PYZus{}datasets}\PY{p}{[}\PY{n}{ticker}\PY{p}{]} \PY{o}{=} \PY{n}{index}\PY{o}{.}\PY{n}{history}\PY{p}{(}\PY{n}{start}\PY{o}{=}\PY{l+s+s2}{\PYZdq{}}\PY{l+s+s2}{1992\PYZhy{}11\PYZhy{}20}\PY{l+s+s2}{\PYZdq{}}\PY{p}{)}   \PY{c+c1}{\PYZsh{}(start=\PYZdq{}1992\PYZhy{}11\PYZhy{}20\PYZdq{})}
    \PY{c+c1}{\PYZsh{} Convert the Date column to Datetime}
    \PY{p}{(}\PY{n}{index\PYZus{}datasets}\PY{p}{[}\PY{n}{ticker}\PY{p}{]}\PY{p}{)}\PY{o}{.}\PY{n}{index} \PY{o}{=} \PY{n}{pd}\PY{o}{.}\PY{n}{to\PYZus{}datetime}\PY{p}{(}\PY{p}{(}\PY{n}{index\PYZus{}datasets}\PY{p}{[}\PY{n}{ticker}\PY{p}{]}\PY{p}{)}\PY{o}{.}\PY{n}{index}\PY{o}{.}\PY{n}{normalize}\PY{p}{(}\PY{p}{)}\PY{o}{.}\PY{n}{tz\PYZus{}localize}\PY{p}{(}\PY{k+kc}{None}\PY{p}{)}\PY{p}{)}
    \PY{n}{index\PYZus{}datasets}\PY{p}{[}\PY{n}{ticker}\PY{p}{]} \PY{o}{=} \PY{n+nb}{round}\PY{p}{(}\PY{n}{index\PYZus{}datasets}\PY{p}{[}\PY{n}{ticker}\PY{p}{]}\PY{p}{,}\PY{l+m+mi}{12}\PY{p}{)}
\end{Verbatim}
\end{tcolorbox}

    \subsubsection{Compute log-returns}\label{compute-log-returns}

We merge all of the data stored in the index\_datasets dictionary into
one Pandas dataframe. We sample the data on a monthly basis, using a
forward fill to account for any missing dates. The forward fill is
required to account for different exchanges having different holidays.
We then compute the monthly log-returns for each index. We then drop all
data apart from the date and monthly log-returns from our dataframe.

    \begin{tcolorbox}[breakable, size=fbox, boxrule=1pt, pad at break*=1mm,colback=cellbackground, colframe=cellborder]
\prompt{In}{incolor}{3}{\boxspacing}
\begin{Verbatim}[commandchars=\\\{\}]
\PY{c+c1}{\PYZsh{} Initialize a DataFrame to store merged data}
\PY{n}{merged\PYZus{}data} \PY{o}{=} \PY{n}{pd}\PY{o}{.}\PY{n}{DataFrame}\PY{p}{(}\PY{p}{)}
\PY{c+c1}{\PYZsh{} Loop over each ticker symbol to fetch the data}
\PY{k}{for} \PY{n}{ticker} \PY{o+ow}{in} \PY{n}{all\PYZus{}tickers}\PY{p}{:}
    \PY{n}{index\PYZus{}data} \PY{o}{=} \PY{n}{index\PYZus{}datasets}\PY{p}{[}\PY{n}{ticker}\PY{p}{]}
    \PY{c+c1}{\PYZsh{} Extract only the Date and Close columns, reset the index}
    \PY{n}{close\PYZus{}data} \PY{o}{=} \PY{p}{(}\PY{n}{index\PYZus{}data}\PY{p}{[}\PY{p}{[}\PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{Close}\PY{l+s+s1}{\PYZsq{}}\PY{p}{]}\PY{p}{]}\PY{p}{)}\PY{o}{.}\PY{n}{copy}\PY{p}{(}\PY{p}{)}
    \PY{n}{close\PYZus{}data}\PY{o}{.}\PY{n}{rename}\PY{p}{(}\PY{n}{columns}\PY{o}{=}\PY{p}{\PYZob{}}\PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{Close}\PY{l+s+s1}{\PYZsq{}}\PY{p}{:} \PY{n}{ticker}\PY{p}{\PYZcb{}}\PY{p}{,}\PY{n}{inplace}\PY{o}{=}\PY{k+kc}{True}\PY{p}{)}
    \PY{c+c1}{\PYZsh{} Merge with the previously merged data}
    \PY{k}{if} \PY{n}{merged\PYZus{}data}\PY{o}{.}\PY{n}{empty}\PY{p}{:}\PY{n}{merged\PYZus{}data} \PY{o}{=} \PY{n}{close\PYZus{}data}
    \PY{k}{else}\PY{p}{:}\PY{n}{merged\PYZus{}data} \PY{o}{=} \PY{n}{pd}\PY{o}{.}\PY{n}{merge}\PY{p}{(}\PY{n}{merged\PYZus{}data}\PY{p}{,} \PY{n}{close\PYZus{}data}\PY{p}{,} \PY{n}{on}\PY{o}{=}\PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{Date}\PY{l+s+s1}{\PYZsq{}}\PY{p}{)}

\PY{k}{for} \PY{n}{ticker} \PY{o+ow}{in} \PY{n}{all\PYZus{}tickers}\PY{p}{:} \PY{n}{merged\PYZus{}data}\PY{p}{[}\PY{n}{ticker}\PY{p}{]} \PY{o}{=} \PY{n}{merged\PYZus{}data}\PY{p}{[}\PY{n}{ticker}\PY{p}{]}\PY{o}{.}\PY{n}{ffill}\PY{p}{(}\PY{p}{)} \PY{c+c1}{\PYZsh{}Forward fill missing data}

\PY{n}{merged\PYZus{}data} \PY{o}{=} \PY{n}{merged\PYZus{}data}\PY{o}{.}\PY{n}{resample}\PY{p}{(}\PY{l+s+s2}{\PYZdq{}}\PY{l+s+s2}{ME}\PY{l+s+s2}{\PYZdq{}}\PY{p}{)}\PY{o}{.}\PY{n}{last}\PY{p}{(}\PY{p}{)} \PY{c+c1}{\PYZsh{}Resample at end of each month}
\PY{n}{merged\PYZus{}data}\PY{p}{[}\PY{p}{:}\PY{p}{]} \PY{o}{=} \PY{n}{np}\PY{o}{.}\PY{n}{log}\PY{p}{(}\PY{l+m+mi}{1}\PY{o}{+}\PY{n}{merged\PYZus{}data}\PY{o}{.}\PY{n}{pct\PYZus{}change}\PY{p}{(}\PY{p}{)}\PY{p}{)} \PY{c+c1}{\PYZsh{}Compute Log Returns}
\PY{n}{merged\PYZus{}data}\PY{o}{.}\PY{n}{dropna}\PY{p}{(}\PY{n}{inplace}\PY{o}{=}\PY{k+kc}{True}\PY{p}{)}\PY{c+c1}{\PYZsh{}Drop blank entries in first row (if any)}
\end{Verbatim}
\end{tcolorbox}

    \section{Model Fitting}\label{model-fitting}

    \subsection{Compute Empirical Moments}\label{compute-empirical-moments}

    \begin{tcolorbox}[breakable, size=fbox, boxrule=1pt, pad at break*=1mm,colback=cellbackground, colframe=cellborder]
\prompt{In}{incolor}{4}{\boxspacing}
\begin{Verbatim}[commandchars=\\\{\}]
\PY{n+nb}{print}\PY{p}{(}\PY{l+s+s2}{\PYZdq{}}\PY{l+s+s2}{Empirical moments for each index}\PY{l+s+s2}{\PYZsq{}}\PY{l+s+s2}{s monthly log\PYZhy{}returns:}\PY{l+s+se}{\PYZbs{}n}\PY{l+s+s2}{\PYZdq{}}\PY{p}{)}
\PY{n}{moments\PYZus{}df} \PY{o}{=} \PY{n}{pd}\PY{o}{.}\PY{n}{DataFrame}\PY{p}{(}\PY{n}{columns}\PY{o}{=}\PY{p}{[}\PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{Mean}\PY{l+s+s1}{\PYZsq{}}\PY{p}{,} \PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{Variance}\PY{l+s+s1}{\PYZsq{}}\PY{p}{,} \PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{Skewness}\PY{l+s+s1}{\PYZsq{}}\PY{p}{,} \PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{Kurtosis}\PY{l+s+s1}{\PYZsq{}}\PY{p}{]}\PY{p}{,} \PY{n}{index}\PY{o}{=}\PY{n}{all\PYZus{}tickers}\PY{p}{)}

\PY{c+c1}{\PYZsh{} Calculate and print empirical moments for each ticker}
\PY{k}{for} \PY{n}{ticker} \PY{o+ow}{in} \PY{n}{all\PYZus{}tickers}\PY{p}{:}
    \PY{n}{data} \PY{o}{=} \PY{n}{merged\PYZus{}data}\PY{p}{[}\PY{n}{ticker}\PY{p}{]} 
    \PY{n}{moments\PYZus{}df}\PY{o}{.}\PY{n}{loc}\PY{p}{[}\PY{n}{ticker}\PY{p}{,} \PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{Mean}\PY{l+s+s1}{\PYZsq{}}\PY{p}{]} \PY{o}{=} \PY{n}{data}\PY{o}{.}\PY{n}{mean}\PY{p}{(}\PY{p}{)}
    \PY{n}{moments\PYZus{}df}\PY{o}{.}\PY{n}{loc}\PY{p}{[}\PY{n}{ticker}\PY{p}{,} \PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{Variance}\PY{l+s+s1}{\PYZsq{}}\PY{p}{]} \PY{o}{=} \PY{n}{data}\PY{o}{.}\PY{n}{var}\PY{p}{(}\PY{p}{)}
    \PY{n}{moments\PYZus{}df}\PY{o}{.}\PY{n}{loc}\PY{p}{[}\PY{n}{ticker}\PY{p}{,} \PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{Skewness}\PY{l+s+s1}{\PYZsq{}}\PY{p}{]} \PY{o}{=} \PY{n}{data}\PY{o}{.}\PY{n}{skew}\PY{p}{(}\PY{p}{)}
    \PY{n}{moments\PYZus{}df}\PY{o}{.}\PY{n}{loc}\PY{p}{[}\PY{n}{ticker}\PY{p}{,} \PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{Kurtosis}\PY{l+s+s1}{\PYZsq{}}\PY{p}{]} \PY{o}{=} \PY{n}{data}\PY{o}{.}\PY{n}{kurtosis}\PY{p}{(}\PY{p}{)}
\PY{n}{display}\PY{p}{(}\PY{n}{moments\PYZus{}df}\PY{p}{)}
\end{Verbatim}
\end{tcolorbox}

    \begin{Verbatim}[commandchars=\\\{\}]
Empirical moments for each index's monthly log-returns:

    \end{Verbatim}

    
    \begin{Verbatim}[commandchars=\\\{\}]
             Mean  Variance  Skewness  Kurtosis
\^{}GDAXI   0.006691  0.003432 -0.824921   2.75046
\^{}AEX     0.005077  0.002829 -0.934099  2.595312
\^{}FTSE     0.00283  0.001509 -0.698239  1.198767
\^{}N225    0.002085  0.003134 -0.584036  1.236407
\^{}GSPC     0.00687  0.001819 -0.661003  1.198823
\^{}GSPTSE  0.005288  0.001735 -1.062607  3.589094
\^{}TYX    -0.001296  0.004282 -0.132169   3.96768
    \end{Verbatim}

    
    \subsection{Fit GARCH Models}\label{fit-garch-models}

Here, we first fit a Students-t GARCH model to the log-return data for
each index, using the arch library. To do this, we must first decide
what order \((p)\) to use for the GARCH terms \((\sigma^2_t)\), and what
order \((q)\) to use for the ARCH Terms \((\epsilon_t)\).

    \subsubsection{Choose (p,q)}\label{choose-pq}

We will test different pairs of \((p,q)\), and choose the one with the
lowest average Akaike Information Criterion (AIC) across all
distributions and indices. Note that we are actually fitting the GARCH
model to 100 times the log-return data, as recommended by the library
documentation. This is done to improve numerical stability.

    \begin{tcolorbox}[breakable, size=fbox, boxrule=1pt, pad at break*=1mm,colback=cellbackground, colframe=cellborder]
\prompt{In}{incolor}{5}{\boxspacing}
\begin{Verbatim}[commandchars=\\\{\}]
\PY{n}{distributions} \PY{o}{=} \PY{p}{(}\PY{l+s+s2}{\PYZdq{}}\PY{l+s+s2}{normal}\PY{l+s+s2}{\PYZdq{}}\PY{p}{,}\PY{l+s+s2}{\PYZdq{}}\PY{l+s+s2}{t}\PY{l+s+s2}{\PYZdq{}}\PY{p}{,}\PY{l+s+s2}{\PYZdq{}}\PY{l+s+s2}{skewt}\PY{l+s+s2}{\PYZdq{}}\PY{p}{)}
\PY{n}{combinations} \PY{o}{=} \PY{p}{[}\PY{p}{(}\PY{n}{i}\PY{p}{,} \PY{n}{j}\PY{p}{)} \PY{k}{for} \PY{n}{i} \PY{o+ow}{in} \PY{n+nb}{range}\PY{p}{(}\PY{l+m+mi}{1}\PY{p}{,} \PY{l+m+mi}{5}\PY{p}{)} \PY{k}{for} \PY{n}{j} \PY{o+ow}{in} \PY{n+nb}{range}\PY{p}{(}\PY{l+m+mi}{1}\PY{p}{,} \PY{l+m+mi}{5}\PY{p}{)}\PY{p}{]}
\PY{c+c1}{\PYZsh{} i.e. [(1,1),(1,2),...,(1,4),(2,1),(2,2),...,(4,4)]}

\PY{n}{best\PYZus{}AIC} \PY{o}{=} \PY{n}{pd}\PY{o}{.}\PY{n}{DataFrame}\PY{p}{(}\PY{n}{np}\PY{o}{.}\PY{n}{inf}\PY{p}{,}\PY{n}{columns}\PY{o}{=}\PY{n}{all\PYZus{}tickers}\PY{p}{,} \PY{n}{index} \PY{o}{=} \PY{n}{distributions}\PY{p}{)}
\PY{n}{best\PYZus{}pair} \PY{o}{=} \PY{n}{pd}\PY{o}{.}\PY{n}{DataFrame}\PY{p}{(}\PY{n}{columns}\PY{o}{=}\PY{n}{all\PYZus{}tickers}\PY{p}{,} \PY{n}{index} \PY{o}{=} \PY{n}{distributions}\PY{p}{)}

\PY{k}{for} \PY{n}{dist} \PY{o+ow}{in} \PY{n}{distributions}\PY{p}{:}
    \PY{k}{for} \PY{p}{(}\PY{n}{p}\PY{p}{,}\PY{n}{q}\PY{p}{)} \PY{o+ow}{in} \PY{n}{combinations}\PY{p}{:}
        \PY{k}{for} \PY{n}{ticker} \PY{o+ow}{in} \PY{n}{all\PYZus{}tickers}\PY{p}{:}
            \PY{c+c1}{\PYZsh{} as suggested by the documentation, we scale our data to improve numerical stability}
            \PY{n}{model} \PY{o}{=} \PY{n}{arch\PYZus{}model}\PY{p}{(}\PY{n}{merged\PYZus{}data}\PY{p}{[}\PY{n}{ticker}\PY{p}{]}\PY{o}{*}\PY{l+m+mi}{100}\PY{p}{,} \PY{n}{vol}\PY{o}{=}\PY{l+s+s2}{\PYZdq{}}\PY{l+s+s2}{Garch}\PY{l+s+s2}{\PYZdq{}}\PY{p}{,} \PY{n}{p}\PY{o}{=}\PY{n}{p}\PY{p}{,} \PY{n}{q}\PY{o}{=}\PY{n}{q}\PY{p}{,} \PY{n}{dist}\PY{o}{=}\PY{n}{dist}\PY{p}{,} \PY{n}{rescale}\PY{o}{=}\PY{k+kc}{False}\PY{p}{)}  
            \PY{n}{aic} \PY{o}{=} \PY{n}{model}\PY{o}{.}\PY{n}{fit}\PY{p}{(}\PY{n}{options}\PY{o}{=}\PY{p}{\PYZob{}}\PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{maxiter}\PY{l+s+s1}{\PYZsq{}}\PY{p}{:} \PY{l+m+mi}{10000}\PY{p}{,} \PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{ftol}\PY{l+s+s1}{\PYZsq{}}\PY{p}{:} \PY{l+m+mf}{1e\PYZhy{}8}\PY{p}{\PYZcb{}}\PY{p}{,}\PY{n}{disp}\PY{o}{=}\PY{l+s+s2}{\PYZdq{}}\PY{l+s+s2}{off}\PY{l+s+s2}{\PYZdq{}}\PY{p}{)}\PY{o}{.}\PY{n}{aic}
            \PY{c+c1}{\PYZsh{}Record best (p,q) for each dist/index pair}
            \PY{k}{if} \PY{n}{best\PYZus{}AIC}\PY{o}{.}\PY{n}{loc}\PY{p}{[}\PY{n}{dist}\PY{p}{,}\PY{n}{ticker}\PY{p}{]} \PY{o}{\PYZgt{}} \PY{n}{aic}\PY{p}{:}
                \PY{n}{best\PYZus{}AIC}\PY{o}{.}\PY{n}{loc}\PY{p}{[}\PY{n}{dist}\PY{p}{,}\PY{n}{ticker}\PY{p}{]} \PY{o}{=} \PY{n}{aic}
                \PY{n}{best\PYZus{}pair}\PY{o}{.}\PY{n}{loc}\PY{p}{[}\PY{n}{dist}\PY{p}{,}\PY{n}{ticker}\PY{p}{]} \PY{o}{=} \PY{p}{(}\PY{n}{p}\PY{p}{,}\PY{n}{q}\PY{p}{)}
\PY{n}{display}\PY{p}{(}\PY{n}{best\PYZus{}pair}\PY{p}{)}
\PY{n}{display}\PY{p}{(}\PY{n}{best\PYZus{}AIC}\PY{p}{)}
\end{Verbatim}
\end{tcolorbox}

    
    \begin{Verbatim}[commandchars=\\\{\}]
        \^{}GDAXI    \^{}AEX   \^{}FTSE   \^{}N225   \^{}GSPC \^{}GSPTSE    \^{}TYX
normal  (1, 1)  (1, 1)  (1, 1)  (1, 1)  (1, 1)  (1, 1)  (1, 4)
t       (1, 1)  (1, 1)  (1, 1)  (1, 1)  (1, 1)  (1, 1)  (1, 4)
skewt   (1, 1)  (1, 1)  (1, 1)  (1, 1)  (1, 1)  (1, 1)  (1, 4)
    \end{Verbatim}

    
    
    \begin{Verbatim}[commandchars=\\\{\}]
             \^{}GDAXI         \^{}AEX        \^{}FTSE        \^{}N225        \^{}GSPC  \textbackslash{}
normal  2417.101759  2309.746993  2106.259017  2418.134960  2151.502832   
t       2393.009971  2305.313312  2102.273644  2415.909522  2150.634685   
skewt   2380.483416  2291.146543  2086.902825  2404.967300  2128.086483   

            \^{}GSPTSE         \^{}TYX  
normal  2142.290945  2449.473316  
t       2126.277537  2424.195133  
skewt   2109.856289  2424.355801  
    \end{Verbatim}

    
    The above results suggest that GARCH(1,1) models best fit our data, for
all distribution/equity index pairs. Also, the skewed Student's-t
GARCH(1,1) model has the best fit for all equity indices, as evident by
its relatively lower AIC. Thus, it is best if we set the order of our
GARCH and ARCH terms to (1,1), for each index and distribution.

    \subsubsection{Fit GARCH(1,1) models}\label{fit-garch11-models}

Next, we will save our normal, Student's-t and skewed Student's-t
GARCH(1,1) models, as well as their standardized residuals. We also
model the US 30 Yield Treasury Bond yield, to illustrate the situation
in our introduction.

    \begin{tcolorbox}[breakable, size=fbox, boxrule=1pt, pad at break*=1mm,colback=cellbackground, colframe=cellborder]
\prompt{In}{incolor}{6}{\boxspacing}
\begin{Verbatim}[commandchars=\\\{\}]
\PY{n}{fitted\PYZus{}models} \PY{p}{,}\PY{n}{params}\PY{p}{,} \PY{n}{std\PYZus{}residuals} \PY{o}{=} \PY{p}{\PYZob{}}\PY{p}{\PYZcb{}}\PY{p}{,} \PY{p}{\PYZob{}}\PY{p}{\PYZcb{}}\PY{p}{,} \PY{p}{\PYZob{}}\PY{p}{\PYZcb{}}
\PY{c+c1}{\PYZsh{}Fit each GARCH model, store models in fitted\PYZus{}models dictionary and standarized residuals in std\PYZus{}residuals dataframe}
\PY{k}{for} \PY{n}{dist} \PY{o+ow}{in} \PY{n}{distributions}\PY{p}{:}
        \PY{c+c1}{\PYZsh{} as suggested by the documentation, we scale our data to improve numerical stability}
    \PY{n}{fitted\PYZus{}models}\PY{p}{[}\PY{n}{dist}\PY{p}{]} \PY{o}{=} \PY{p}{\PYZob{}}\PY{n}{ticker}\PY{p}{:} \PY{n}{arch\PYZus{}model}\PY{p}{(}\PY{n}{merged\PYZus{}data}\PY{p}{[}\PY{n}{ticker}\PY{p}{]}\PY{o}{*}\PY{l+m+mi}{100}\PY{p}{,} \PY{n}{vol}\PY{o}{=}\PY{l+s+s2}{\PYZdq{}}\PY{l+s+s2}{Garch}\PY{l+s+s2}{\PYZdq{}}\PY{p}{,} \PY{n}{p}\PY{o}{=}\PY{l+m+mi}{1}\PY{p}{,} \PY{n}{q}\PY{o}{=}\PY{l+m+mi}{1}\PY{p}{,} \PY{n}{dist}\PY{o}{=}\PY{n}{dist}\PY{p}{,} \PY{n}{rescale}\PY{o}{=}\PY{k+kc}{False}\PY{p}{)}
                                        \PY{o}{.}\PY{n}{fit}\PY{p}{(}\PY{n}{options}\PY{o}{=}\PY{p}{\PYZob{}}\PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{maxiter}\PY{l+s+s1}{\PYZsq{}}\PY{p}{:} \PY{l+m+mi}{1000}\PY{p}{,} \PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{ftol}\PY{l+s+s1}{\PYZsq{}}\PY{p}{:} \PY{l+m+mf}{1e\PYZhy{}8}\PY{p}{\PYZcb{}}\PY{p}{,}\PY{n}{disp}\PY{o}{=}\PY{l+s+s2}{\PYZdq{}}\PY{l+s+s2}{off}\PY{l+s+s2}{\PYZdq{}}\PY{p}{)} 
                                    \PY{k}{for} \PY{n}{ticker} \PY{o+ow}{in} \PY{n}{all\PYZus{}tickers}\PY{p}{\PYZcb{}}   
    \PY{n}{std\PYZus{}residuals}\PY{p}{[}\PY{n}{dist}\PY{p}{]} \PY{o}{=} \PY{n}{pd}\PY{o}{.}\PY{n}{DataFrame}\PY{p}{(}\PY{p}{[}\PY{n}{fitted\PYZus{}models}\PY{p}{[}\PY{n}{dist}\PY{p}{]}\PY{p}{[}\PY{n}{ticker}\PY{p}{]}\PY{o}{.}\PY{n}{resid} \PY{o}{/} \PY{n}{fitted\PYZus{}models}\PY{p}{[}\PY{n}{dist}\PY{p}{]}\PY{p}{[}\PY{n}{ticker}\PY{p}{]}\PY{o}{.}\PY{n}{conditional\PYZus{}volatility}
                                        \PY{k}{for} \PY{n}{ticker} \PY{o+ow}{in} \PY{n}{all\PYZus{}tickers}\PY{p}{]}\PY{p}{,}\PY{n}{index} \PY{o}{=} \PY{n}{all\PYZus{}tickers}\PY{p}{)}\PY{o}{.}\PY{n}{T}
\PY{c+c1}{\PYZsh{}Creates a dataframe with the fitted parameters from each model}
\PY{n+nb}{print}\PY{p}{(}\PY{l+s+s2}{\PYZdq{}}\PY{l+s+s2}{Fitted parameters for each model:}\PY{l+s+s2}{\PYZdq{}}\PY{p}{)}
\PY{k}{for} \PY{n}{dist} \PY{o+ow}{in} \PY{n}{distributions}\PY{p}{:}
    \PY{n}{params}\PY{p}{[}\PY{n}{dist}\PY{p}{]} \PY{o}{=} \PY{n}{pd}\PY{o}{.}\PY{n}{DataFrame}\PY{p}{(}\PY{n}{columns}\PY{o}{=}\PY{n}{all\PYZus{}tickers}\PY{p}{)}
    \PY{k}{for} \PY{n}{ticker} \PY{o+ow}{in} \PY{n}{all\PYZus{}tickers}\PY{p}{:}
        \PY{n}{params}\PY{p}{[}\PY{n}{dist}\PY{p}{]}\PY{p}{[}\PY{n}{ticker}\PY{p}{]} \PY{o}{=} \PY{n}{fitted\PYZus{}models}\PY{p}{[}\PY{n}{dist}\PY{p}{]}\PY{p}{[}\PY{n}{ticker}\PY{p}{]}\PY{o}{.}\PY{n}{params}
    \PY{n+nb}{print}\PY{p}{(}\PY{l+s+s2}{\PYZdq{}}\PY{l+s+se}{\PYZbs{}n}\PY{l+s+s2}{Model: }\PY{l+s+s2}{\PYZdq{}}\PY{o}{+}\PY{n}{dist}\PY{p}{,}\PY{n}{end}\PY{o}{=}\PY{l+s+s2}{\PYZdq{}}\PY{l+s+s2}{\PYZdq{}}\PY{p}{)}
    \PY{n}{display}\PY{p}{(}\PY{n}{params}\PY{p}{[}\PY{n}{dist}\PY{p}{]}\PY{p}{)}
\end{Verbatim}
\end{tcolorbox}

    \begin{Verbatim}[commandchars=\\\{\}]
Fitted parameters for each model:

Model: normal
    \end{Verbatim}

    
    \begin{Verbatim}[commandchars=\\\{\}]
            \^{}GDAXI      \^{}AEX     \^{}FTSE      \^{}N225     \^{}GSPC   \^{}GSPTSE  \textbackslash{}
mu        0.962595  0.815584  0.467662   0.306701  0.861011  0.840098   
omega     4.472001  3.101404  1.466476  12.145274  1.016401  2.388316   
alpha[1]  0.195138  0.267256  0.172319   0.114560  0.188905  0.349941   
beta[1]   0.684832  0.635464  0.736607   0.496925  0.764643  0.562227   

              \^{}TYX  
mu       -0.254837  
omega     7.062766  
alpha[1]  0.251255  
beta[1]   0.581669  
    \end{Verbatim}

    
    \begin{Verbatim}[commandchars=\\\{\}]

Model: t
    \end{Verbatim}

    
    \begin{Verbatim}[commandchars=\\\{\}]
            \^{}GDAXI      \^{}AEX     \^{}FTSE      \^{}N225      \^{}GSPC   \^{}GSPTSE  \textbackslash{}
mu        1.176980  0.905821  0.597849   0.473077   0.966314  0.827391   
omega     3.303976  3.456597  1.657939   2.203972   1.003940  1.468203   
alpha[1]  0.188118  0.251224  0.186542   0.048784   0.193731  0.191023   
beta[1]   0.728181  0.632739  0.713412   0.878970   0.763205  0.735646   
nu        5.893826  9.413719  9.095880  12.441729  12.054167  6.716557   

              \^{}TYX  
mu       -0.243223  
omega     0.616889  
alpha[1]  0.061737  
beta[1]   0.927331  
nu        5.073379  
    \end{Verbatim}

    
    \begin{Verbatim}[commandchars=\\\{\}]

Model: skewt
    \end{Verbatim}

    
    \begin{Verbatim}[commandchars=\\\{\}]
            \^{}GDAXI       \^{}AEX      \^{}FTSE      \^{}N225      \^{}GSPC   \^{}GSPTSE  \textbackslash{}
mu        0.861619   0.704819   0.439732   0.291820   0.825220  0.601850   
omega     3.478294   2.689154   1.551337   2.877517   0.961396  1.092803   
alpha[1]  0.172326   0.233617   0.159156   0.065356   0.192949  0.156737   
beta[1]   0.728239   0.674386   0.735369   0.839261   0.759284  0.786065   
eta       6.781941  11.166049  13.521038  18.893520  15.622132  8.196171   
lambda   -0.288247  -0.300320  -0.304656  -0.262524  -0.352774 -0.340294   

              \^{}TYX  
mu       -0.335107  
omega     0.744395  
alpha[1]  0.076044  
beta[1]   0.910711  
eta       5.420261  
lambda   -0.088599  
    \end{Verbatim}

    
    Recall that we scaled our log-returns by a factor of \(100\) before
fitting each model. Hence, our mean returns (mu) above are scaled by a
factor of \(100\), while our baseline variances (omega) are scaled by a
factor of \(100^2\).

We note that, in each model, the Nikkei 225 returns have a low alpha
parameter, suggesting a lack of volatility clustering. Additionally,
when compared to the other indices, we note that the Nikkei 225 and S\&P
500 returns demonstrate thinner tails, as demonstrated by the relatively
greater degrees of freedom in both the classical and skewed Student's-t
GARCH models. We observe that each index's returns are negatively
skewed, as evident by the lambda parameter in the skewed Student's-t
GARCH models. From here on, we will only focus on equity indices, as
they are the main focus of this study.

    \begin{tcolorbox}[breakable, size=fbox, boxrule=1pt, pad at break*=1mm,colback=cellbackground, colframe=cellborder]
\prompt{In}{incolor}{7}{\boxspacing}
\begin{Verbatim}[commandchars=\\\{\}]
\PY{n}{tickers} \PY{o}{=} \PY{p}{[}\PY{l+s+s2}{\PYZdq{}}\PY{l+s+s2}{\PYZca{}GDAXI}\PY{l+s+s2}{\PYZdq{}}\PY{p}{,} \PY{l+s+s2}{\PYZdq{}}\PY{l+s+s2}{\PYZca{}AEX}\PY{l+s+s2}{\PYZdq{}}\PY{p}{,} \PY{l+s+s2}{\PYZdq{}}\PY{l+s+s2}{\PYZca{}FTSE}\PY{l+s+s2}{\PYZdq{}}\PY{p}{,} \PY{l+s+s2}{\PYZdq{}}\PY{l+s+s2}{\PYZca{}N225}\PY{l+s+s2}{\PYZdq{}}\PY{p}{,} \PY{l+s+s2}{\PYZdq{}}\PY{l+s+s2}{\PYZca{}GSPC}\PY{l+s+s2}{\PYZdq{}}\PY{p}{,} \PY{l+s+s2}{\PYZdq{}}\PY{l+s+s2}{\PYZca{}GSPTSE}\PY{l+s+s2}{\PYZdq{}}\PY{p}{]} \PY{c+c1}{\PYZsh{}Drop \PYZdq{}\PYZca{}TYX\PYZdq{}}
\PY{n}{merged\PYZus{}data} \PY{o}{=} \PY{n}{merged\PYZus{}data}\PY{p}{[}\PY{n}{tickers}\PY{p}{]}
\PY{k}{for} \PY{n}{dist} \PY{o+ow}{in} \PY{n}{distributions}\PY{p}{:} \PY{n}{std\PYZus{}residuals}\PY{p}{[}\PY{n}{dist}\PY{p}{]} \PY{o}{=} \PY{n}{std\PYZus{}residuals}\PY{p}{[}\PY{n}{dist}\PY{p}{]}\PY{p}{[}\PY{n}{tickers}\PY{p}{]}
\end{Verbatim}
\end{tcolorbox}

    \subsection{GARCH Goodness of Fit
Tests}\label{garch-goodness-of-fit-tests}

    \subsubsection{Plot ACF of Standardized
Residuals}\label{plot-acf-of-standardized-residuals}

We plot the ACF of the residuals of each GARCH, and display them side by
side for comparison.

    \begin{tcolorbox}[breakable, size=fbox, boxrule=1pt, pad at break*=1mm,colback=cellbackground, colframe=cellborder]
\prompt{In}{incolor}{8}{\boxspacing}
\begin{Verbatim}[commandchars=\\\{\}]
\PY{n}{fig}\PY{p}{,} \PY{n}{axes} \PY{o}{=} \PY{n}{plt}\PY{o}{.}\PY{n}{subplots}\PY{p}{(}\PY{l+m+mi}{3}\PY{p}{,} \PY{n+nb}{len}\PY{p}{(}\PY{n}{tickers}\PY{p}{)}\PY{p}{,} \PY{n}{figsize}\PY{o}{=}\PY{p}{(}\PY{l+m+mi}{5} \PY{o}{*} \PY{n+nb}{len}\PY{p}{(}\PY{n}{tickers}\PY{p}{)}\PY{p}{,} \PY{l+m+mi}{5}\PY{o}{*}\PY{l+m+mi}{3}\PY{p}{)}\PY{p}{)}
\PY{k}{for} \PY{n}{i} \PY{o+ow}{in} \PY{n+nb}{range}\PY{p}{(}\PY{n+nb}{len}\PY{p}{(}\PY{n}{distributions}\PY{p}{)}\PY{p}{)}\PY{p}{:}
    \PY{k}{for} \PY{n}{j} \PY{o+ow}{in} \PY{n+nb}{range}\PY{p}{(}\PY{n+nb}{len}\PY{p}{(}\PY{n}{tickers}\PY{p}{)}\PY{p}{)}\PY{p}{:}
        \PY{n}{dist}\PY{p}{,} \PY{n}{ticker} \PY{o}{=} \PY{n}{distributions}\PY{p}{[}\PY{n}{i}\PY{p}{]}\PY{p}{,} \PY{n}{tickers}\PY{p}{[}\PY{n}{j}\PY{p}{]}
        \PY{n}{plot\PYZus{}acf}\PY{p}{(}\PY{n}{std\PYZus{}residuals}\PY{p}{[}\PY{n}{dist}\PY{p}{]}\PY{p}{[}\PY{n}{ticker}\PY{p}{]}\PY{p}{,}\PY{n}{lags} \PY{o}{=} \PY{l+m+mi}{50}\PY{p}{,} \PY{n}{ax} \PY{o}{=} \PY{n}{axes}\PY{p}{[}\PY{n}{i}\PY{p}{]}\PY{p}{[}\PY{n}{j}\PY{p}{]}\PY{p}{)}
        \PY{n}{axes}\PY{p}{[}\PY{n}{i}\PY{p}{]}\PY{p}{[}\PY{n}{j}\PY{p}{]}\PY{o}{.}\PY{n}{set\PYZus{}title}\PY{p}{(}\PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{ACF of }\PY{l+s+s1}{\PYZsq{}} \PY{o}{+} \PY{n}{ticker} \PY{o}{+} \PY{l+s+s2}{\PYZdq{}}\PY{l+s+s2}{ }\PY{l+s+s2}{\PYZdq{}} \PY{o}{+} \PY{n}{dist} \PY{o}{+} \PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{ GARCH Residuals}\PY{l+s+s1}{\PYZsq{}}\PY{p}{)}
\PY{n}{plt}\PY{o}{.}\PY{n}{tight\PYZus{}layout}\PY{p}{(}\PY{p}{)}
\end{Verbatim}
\end{tcolorbox}

    \begin{center}
    \adjustimage{max size={0.9\linewidth}{0.9\paperheight}}{program_files/program_23_0.png}
    \end{center}
    { \hspace*{\fill} \\}
    
    The above results suggest that there is little autocorrelation in the
standarized residuals of our fitted GARCH models.

    \subsubsection{Plot ACF of Squared Standardized
Residuals}\label{plot-acf-of-squared-standardized-residuals}

We also plot the ACF of the squared residuals of each GARCH.

    \begin{tcolorbox}[breakable, size=fbox, boxrule=1pt, pad at break*=1mm,colback=cellbackground, colframe=cellborder]
\prompt{In}{incolor}{9}{\boxspacing}
\begin{Verbatim}[commandchars=\\\{\}]
\PY{n}{fig}\PY{p}{,} \PY{n}{axes} \PY{o}{=} \PY{n}{plt}\PY{o}{.}\PY{n}{subplots}\PY{p}{(}\PY{l+m+mi}{3}\PY{p}{,} \PY{n+nb}{len}\PY{p}{(}\PY{n}{tickers}\PY{p}{)}\PY{p}{,} \PY{n}{figsize}\PY{o}{=}\PY{p}{(}\PY{l+m+mi}{5} \PY{o}{*} \PY{n+nb}{len}\PY{p}{(}\PY{n}{tickers}\PY{p}{)}\PY{p}{,} \PY{l+m+mi}{5}\PY{o}{*}\PY{l+m+mi}{3}\PY{p}{)}\PY{p}{)}
\PY{k}{for} \PY{n}{i} \PY{o+ow}{in} \PY{n+nb}{range}\PY{p}{(}\PY{n+nb}{len}\PY{p}{(}\PY{n}{distributions}\PY{p}{)}\PY{p}{)}\PY{p}{:}
    \PY{k}{for} \PY{n}{j} \PY{o+ow}{in} \PY{n+nb}{range}\PY{p}{(}\PY{n+nb}{len}\PY{p}{(}\PY{n}{tickers}\PY{p}{)}\PY{p}{)}\PY{p}{:}
        \PY{n}{dist}\PY{p}{,} \PY{n}{ticker} \PY{o}{=} \PY{n}{distributions}\PY{p}{[}\PY{n}{i}\PY{p}{]}\PY{p}{,} \PY{n}{tickers}\PY{p}{[}\PY{n}{j}\PY{p}{]}
        \PY{n}{plot\PYZus{}acf}\PY{p}{(}\PY{n}{std\PYZus{}residuals}\PY{p}{[}\PY{n}{dist}\PY{p}{]}\PY{p}{[}\PY{n}{ticker}\PY{p}{]}\PY{o}{*}\PY{o}{*}\PY{l+m+mi}{2}\PY{p}{,}\PY{n}{lags} \PY{o}{=} \PY{l+m+mi}{50}\PY{p}{,} \PY{n}{ax} \PY{o}{=} \PY{n}{axes}\PY{p}{[}\PY{n}{i}\PY{p}{]}\PY{p}{[}\PY{n}{j}\PY{p}{]}\PY{p}{)}
        \PY{n}{axes}\PY{p}{[}\PY{n}{i}\PY{p}{]}\PY{p}{[}\PY{n}{j}\PY{p}{]}\PY{o}{.}\PY{n}{set\PYZus{}title}\PY{p}{(}\PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{ACF of }\PY{l+s+s1}{\PYZsq{}} \PY{o}{+} \PY{n}{ticker} \PY{o}{+} \PY{l+s+s2}{\PYZdq{}}\PY{l+s+s2}{ }\PY{l+s+s2}{\PYZdq{}} \PY{o}{+} \PY{n}{dist} \PY{o}{+} \PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{ Squared GARCH Residuals}\PY{l+s+s1}{\PYZsq{}}\PY{p}{)}
\PY{n}{plt}\PY{o}{.}\PY{n}{tight\PYZus{}layout}\PY{p}{(}\PY{p}{)}
\end{Verbatim}
\end{tcolorbox}

    \begin{center}
    \adjustimage{max size={0.9\linewidth}{0.9\paperheight}}{program_files/program_26_0.png}
    \end{center}
    { \hspace*{\fill} \\}
    
    The above results suggest that there is little autocorrelation in the
standarized squared residuals of our fitted GARCH models.

    \subsubsection{Plot QQ Plot for
residuals}\label{plot-qq-plot-for-residuals}

We also conduct a QQ Plot of the standardized residuals of each GARCH.

    \begin{tcolorbox}[breakable, size=fbox, boxrule=1pt, pad at break*=1mm,colback=cellbackground, colframe=cellborder]
\prompt{In}{incolor}{10}{\boxspacing}
\begin{Verbatim}[commandchars=\\\{\}]
\PY{n}{fig}\PY{p}{,} \PY{n}{axes} \PY{o}{=} \PY{n}{plt}\PY{o}{.}\PY{n}{subplots}\PY{p}{(}\PY{l+m+mi}{3}\PY{p}{,} \PY{n+nb}{len}\PY{p}{(}\PY{n}{tickers}\PY{p}{)}\PY{p}{,} \PY{n}{figsize}\PY{o}{=}\PY{p}{(}\PY{l+m+mi}{5} \PY{o}{*} \PY{n+nb}{len}\PY{p}{(}\PY{n}{tickers}\PY{p}{)}\PY{p}{,} \PY{l+m+mi}{5}\PY{o}{*}\PY{l+m+mi}{3}\PY{p}{)}\PY{p}{)}
\PY{k}{for} \PY{n}{i} \PY{o+ow}{in} \PY{n+nb}{range}\PY{p}{(}\PY{n+nb}{len}\PY{p}{(}\PY{n}{distributions}\PY{p}{)}\PY{p}{)}\PY{p}{:}
    
    \PY{n}{quantiles} \PY{o}{=} \PY{p}{(}\PY{n}{np}\PY{o}{.}\PY{n}{arange}\PY{p}{(}\PY{l+m+mi}{1}\PY{p}{,} \PY{n+nb}{len}\PY{p}{(}\PY{n}{merged\PYZus{}data}\PY{p}{)} \PY{o}{+} \PY{l+m+mi}{1}\PY{p}{)} \PY{o}{\PYZhy{}} \PY{l+m+mf}{0.5}\PY{p}{)} \PY{o}{/} \PY{n+nb}{len}\PY{p}{(}\PY{n}{merged\PYZus{}data}\PY{p}{)}

    \PY{k}{for} \PY{n}{j} \PY{o+ow}{in} \PY{n+nb}{range}\PY{p}{(}\PY{n+nb}{len}\PY{p}{(}\PY{n}{tickers}\PY{p}{)}\PY{p}{)}\PY{p}{:}  \PY{c+c1}{\PYZsh{} Get theoretical quantiles}
        \PY{n}{dist}\PY{p}{,} \PY{n}{ticker} \PY{o}{=} \PY{n}{distributions}\PY{p}{[}\PY{n}{i}\PY{p}{]}\PY{p}{,} \PY{n}{tickers}\PY{p}{[}\PY{n}{j}\PY{p}{]}
        \PY{k}{if} \PY{n}{dist} \PY{o}{==} \PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{normal}\PY{l+s+s1}{\PYZsq{}}\PY{p}{:} \PY{n}{theoretical\PYZus{}quantiles}  \PY{o}{=}  \PY{n}{np}\PY{o}{.}\PY{n}{quantile}\PY{p}{(}\PY{n}{norm}\PY{o}{.}\PY{n}{rvs}\PY{p}{(}\PY{l+m+mi}{0}\PY{p}{,}\PY{l+m+mi}{1}\PY{p}{,}\PY{l+m+mi}{10000}\PY{p}{)}\PY{p}{,} \PY{n}{quantiles}\PY{p}{)}
        \PY{k}{elif} \PY{n}{dist} \PY{o}{==} \PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{t}\PY{l+s+s1}{\PYZsq{}}\PY{p}{:}
            \PY{n}{nu} \PY{o}{=} \PY{n}{params}\PY{p}{[}\PY{n}{dist}\PY{p}{]}\PY{p}{[}\PY{n}{ticker}\PY{p}{]}\PY{p}{[}\PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{nu}\PY{l+s+s1}{\PYZsq{}}\PY{p}{]}
            \PY{n}{theoretical\PYZus{}quantiles}  \PY{o}{=}  \PY{n}{np}\PY{o}{.}\PY{n}{quantile}\PY{p}{(}\PY{n}{t}\PY{o}{.}\PY{n}{rvs}\PY{p}{(}\PY{n}{nu}\PY{p}{,}\PY{l+m+mi}{0}\PY{p}{,}\PY{l+m+mi}{1}\PY{p}{,}\PY{l+m+mi}{10000}\PY{p}{)}\PY{p}{,} \PY{n}{quantiles}\PY{p}{)}
        \PY{k}{elif} \PY{n}{dist} \PY{o}{==} \PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{skewt}\PY{l+s+s1}{\PYZsq{}}\PY{p}{:} 
            \PY{n}{eta} \PY{o}{=} \PY{n}{params}\PY{p}{[}\PY{n}{dist}\PY{p}{]}\PY{p}{[}\PY{n}{ticker}\PY{p}{]}\PY{p}{[}\PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{eta}\PY{l+s+s1}{\PYZsq{}}\PY{p}{]}
            \PY{n}{lambda\PYZus{}param} \PY{o}{=} \PY{n}{params}\PY{p}{[}\PY{n}{dist}\PY{p}{]}\PY{p}{[}\PY{n}{ticker}\PY{p}{]}\PY{p}{[}\PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{lambda}\PY{l+s+s1}{\PYZsq{}}\PY{p}{]}
            \PY{n}{skew\PYZus{}t\PYZus{}rvs} \PY{o}{=} \PY{n}{SkewStudent}\PY{p}{(}\PY{p}{)}\PY{o}{.}\PY{n}{simulate}\PY{p}{(}\PY{n}{parameters}\PY{o}{=}\PY{p}{[}\PY{n}{eta}\PY{p}{,} \PY{n}{lambda\PYZus{}param}\PY{p}{]}\PY{p}{)}
            \PY{n}{theoretical\PYZus{}quantiles}  \PY{o}{=}  \PY{n}{np}\PY{o}{.}\PY{n}{quantile}\PY{p}{(}\PY{n}{skew\PYZus{}t\PYZus{}rvs}\PY{p}{(}\PY{l+m+mi}{10000}\PY{p}{)}\PY{p}{,} \PY{n}{quantiles}\PY{p}{)}
            
        \PY{n}{sorted\PYZus{}std\PYZus{}residuals} \PY{o}{=} \PY{n}{np}\PY{o}{.}\PY{n}{quantile}\PY{p}{(}\PY{n}{std\PYZus{}residuals}\PY{p}{[}\PY{n}{dist}\PY{p}{]}\PY{p}{[}\PY{n}{ticker}\PY{p}{]}\PY{p}{,}\PY{n}{quantiles}\PY{p}{)} \PY{c+c1}{\PYZsh{}Sample Quantiles}
        \PY{n}{axes}\PY{p}{[}\PY{n}{i}\PY{p}{]}\PY{p}{[}\PY{n}{j}\PY{p}{]}\PY{o}{.}\PY{n}{plot}\PY{p}{(}\PY{n}{theoretical\PYZus{}quantiles}\PY{p}{,}\PY{n}{sorted\PYZus{}std\PYZus{}residuals}\PY{p}{,}\PY{n}{color} \PY{o}{=} \PY{l+s+s2}{\PYZdq{}}\PY{l+s+s2}{blue}\PY{l+s+s2}{\PYZdq{}}\PY{p}{,} \PY{n}{marker} \PY{o}{=} \PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{o}\PY{l+s+s1}{\PYZsq{}}\PY{p}{)} \PY{c+c1}{\PYZsh{}QQ Plots}
        \PY{n}{axes}\PY{p}{[}\PY{n}{i}\PY{p}{]}\PY{p}{[}\PY{n}{j}\PY{p}{]}\PY{o}{.}\PY{n}{plot}\PY{p}{(}\PY{n}{theoretical\PYZus{}quantiles}\PY{p}{,}\PY{n}{theoretical\PYZus{}quantiles}\PY{p}{,}\PY{n}{color} \PY{o}{=} \PY{l+s+s2}{\PYZdq{}}\PY{l+s+s2}{red}\PY{l+s+s2}{\PYZdq{}}\PY{p}{)}
        \PY{n}{axes}\PY{p}{[}\PY{n}{i}\PY{p}{]}\PY{p}{[}\PY{n}{j}\PY{p}{]}\PY{o}{.}\PY{n}{set\PYZus{}title}\PY{p}{(}\PY{n}{ticker}\PY{p}{)}
    \PY{n}{plt}\PY{o}{.}\PY{n}{tight\PYZus{}layout}\PY{p}{(}\PY{p}{)}    
\end{Verbatim}
\end{tcolorbox}

    \begin{center}
    \adjustimage{max size={0.9\linewidth}{0.9\paperheight}}{program_files/program_29_0.png}
    \end{center}
    { \hspace*{\fill} \\}
    
    The above results suggest that the skewed Student's-t distribution has
the best fit, across all indices. However, most of the our models
predict slightly more extreme negative shocks than the data suggests, as
evident by bottom left regions in the above QQ Plots.

    \subsection{Fit Multivariate Model}\label{fit-multivariate-model}

    \subsubsection{Compute Spearman's Variance-Covariance
Matrix}\label{compute-spearmans-variance-covariance-matrix}

Using the standardized residuals from our Student's t GARCH model, we
calculate the Spearman correlation \& covariance of the standardized
residuals.

    \begin{tcolorbox}[breakable, size=fbox, boxrule=1pt, pad at break*=1mm,colback=cellbackground, colframe=cellborder]
\prompt{In}{incolor}{11}{\boxspacing}
\begin{Verbatim}[commandchars=\\\{\}]
\PY{n}{spearman\PYZus{}cov} \PY{o}{=} \PY{p}{\PYZob{}}\PY{p}{\PYZcb{}}
\PY{n+nb}{print}\PY{p}{(}\PY{l+s+s2}{\PYZdq{}}\PY{l+s+s2}{Spearman Correlation Matrix of Standardized Residuals}\PY{l+s+s2}{\PYZdq{}}\PY{p}{)}
\PY{k}{for} \PY{n}{dist} \PY{o+ow}{in} \PY{n}{distributions}\PY{p}{:}
    \PY{n}{spearman\PYZus{}cov}\PY{p}{[}\PY{n}{dist}\PY{p}{]} \PY{o}{=} \PY{n}{pd}\PY{o}{.}\PY{n}{DataFrame}\PY{p}{(}\PY{n}{index}\PY{o}{=}\PY{n}{tickers}\PY{p}{,}\PY{n}{columns}\PY{o}{=}\PY{n}{tickers}\PY{p}{)}
    \PY{k}{for} \PY{n}{ticker\PYZus{}1} \PY{o+ow}{in} \PY{n}{tickers}\PY{p}{:}
        \PY{k}{for} \PY{n}{ticker\PYZus{}2} \PY{o+ow}{in} \PY{n}{tickers}\PY{p}{:}
            \PY{c+c1}{\PYZsh{}Rank residuals}
            \PY{n}{ranked\PYZus{}residuals\PYZus{}1} \PY{o}{=} \PY{n}{pd}\PY{o}{.}\PY{n}{Series}\PY{p}{(}\PY{n}{std\PYZus{}residuals}\PY{p}{[}\PY{n}{dist}\PY{p}{]}\PY{p}{[}\PY{n}{ticker\PYZus{}1}\PY{p}{]}\PY{p}{)}\PY{o}{.}\PY{n}{rank}\PY{p}{(}\PY{n}{method}\PY{o}{=}\PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{average}\PY{l+s+s1}{\PYZsq{}}\PY{p}{)}
            \PY{n}{ranked\PYZus{}residuals\PYZus{}2} \PY{o}{=} \PY{n}{pd}\PY{o}{.}\PY{n}{Series}\PY{p}{(}\PY{n}{std\PYZus{}residuals}\PY{p}{[}\PY{n}{dist}\PY{p}{]}\PY{p}{[}\PY{n}{ticker\PYZus{}2}\PY{p}{]}\PY{p}{)}\PY{o}{.}\PY{n}{rank}\PY{p}{(}\PY{n}{method}\PY{o}{=}\PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{average}\PY{l+s+s1}{\PYZsq{}}\PY{p}{)} 
            \PY{c+c1}{\PYZsh{}Compute Spearman Correlation Coeff./Covariance }
            \PY{n}{spearman\PYZus{}cov}\PY{p}{[}\PY{n}{dist}\PY{p}{]}\PY{o}{.}\PY{n}{loc}\PY{p}{[}\PY{n}{ticker\PYZus{}1}\PY{p}{,}\PY{n}{ticker\PYZus{}2}\PY{p}{]} \PY{o}{=} \PY{n}{np}\PY{o}{.}\PY{n}{corrcoef}\PY{p}{(}\PY{n}{ranked\PYZus{}residuals\PYZus{}1}\PY{p}{,}\PY{n}{ranked\PYZus{}residuals\PYZus{}2}\PY{p}{)}\PY{p}{[}\PY{l+m+mi}{0}\PY{p}{]}\PY{p}{[}\PY{l+m+mi}{1}\PY{p}{]}
    \PY{n+nb}{print}\PY{p}{(}\PY{l+s+s2}{\PYZdq{}}\PY{l+s+s2}{GARCH Distribution: }\PY{l+s+s2}{\PYZdq{}}\PY{p}{,}\PY{n}{dist}\PY{p}{)}

\PY{n}{display}\PY{p}{(}\PY{n}{spearman\PYZus{}cov}\PY{p}{[}\PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{normal}\PY{l+s+s1}{\PYZsq{}}\PY{p}{]}\PY{p}{,}\PY{n}{spearman\PYZus{}cov}\PY{p}{[}\PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{t}\PY{l+s+s1}{\PYZsq{}}\PY{p}{]}\PY{p}{,}\PY{n}{spearman\PYZus{}cov}\PY{p}{[}\PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{skewt}\PY{l+s+s1}{\PYZsq{}}\PY{p}{]}\PY{p}{)}

\PY{c+c1}{\PYZsh{}spearman\PYZus{}cov[dist] = spearman\PYZus{}cov[dist].to\PYZus{}numpy(dtype=float) \PYZsh{}convert to numpy array for later}
\end{Verbatim}
\end{tcolorbox}

    \begin{Verbatim}[commandchars=\\\{\}]
Spearman Correlation Matrix of Standardized Residuals
GARCH Distribution:  normal
GARCH Distribution:  t
GARCH Distribution:  skewt
    \end{Verbatim}

    
    \begin{Verbatim}[commandchars=\\\{\}]
           \^{}GDAXI      \^{}AEX     \^{}FTSE     \^{}N225     \^{}GSPC   \^{}GSPTSE
\^{}GDAXI        1.0  0.834567  0.722668  0.528286  0.715864  0.639892
\^{}AEX     0.834567       1.0  0.748302  0.527376  0.716041  0.643392
\^{}FTSE    0.722668  0.748302       1.0  0.413915  0.684363  0.675111
\^{}N225    0.528286  0.527376  0.413915       1.0  0.512309  0.436195
\^{}GSPC    0.715864  0.716041  0.684363  0.512309       1.0  0.729924
\^{}GSPTSE  0.639892  0.643392  0.675111  0.436195  0.729924       1.0
    \end{Verbatim}

    
    
    \begin{Verbatim}[commandchars=\\\{\}]
           \^{}GDAXI      \^{}AEX     \^{}FTSE     \^{}N225     \^{}GSPC   \^{}GSPTSE
\^{}GDAXI        1.0  0.834778  0.722214  0.531196  0.713858  0.639495
\^{}AEX     0.834778       1.0  0.747903   0.53113  0.715048  0.648171
\^{}FTSE    0.722214  0.747903       1.0  0.415055  0.682193  0.678865
\^{}N225    0.531196   0.53113  0.415055       1.0  0.515219  0.442805
\^{}GSPC    0.713858  0.715048  0.682193  0.515219       1.0  0.732767
\^{}GSPTSE  0.639495  0.648171  0.678865  0.442805  0.732767       1.0
    \end{Verbatim}

    
    
    \begin{Verbatim}[commandchars=\\\{\}]
           \^{}GDAXI      \^{}AEX     \^{}FTSE     \^{}N225     \^{}GSPC   \^{}GSPTSE
\^{}GDAXI        1.0  0.835828  0.724327   0.53121  0.716047  0.641312
\^{}AEX     0.835828       1.0  0.749276  0.532076  0.716959  0.648551
\^{}FTSE    0.724327  0.749276       1.0  0.416492  0.684318  0.678965
\^{}N225     0.53121  0.532076  0.416492       1.0  0.514127  0.445039
\^{}GSPC    0.716047  0.716959  0.684318  0.514127       1.0  0.732812
\^{}GSPTSE  0.641312  0.648551  0.678965  0.445039  0.732812       1.0
    \end{Verbatim}

    
    \subsubsection{Fit Student's-t Copula}\label{fit-students-t-copula}

Next, we will fit our Student's-t copula to our normal, Student's-t and
skewed Student's-t GARCH marginal residuals. To do this, we will use the
Spearman correlation matrices \(\Sigma_{COR}\) from above. We can
numerically estimate our fitted degrees of freedom \(\nu\), with the
constraint that \(\nu > 2\), by using scipy's minimize function, applied
to our copula's log likelihood function.

    \begin{tcolorbox}[breakable, size=fbox, boxrule=1pt, pad at break*=1mm,colback=cellbackground, colframe=cellborder]
\prompt{In}{incolor}{12}{\boxspacing}
\begin{Verbatim}[commandchars=\\\{\}]
\PY{n}{u}\PY{p}{,}\PY{n}{fitted\PYZus{}df} \PY{o}{=} \PY{p}{\PYZob{}}\PY{p}{\PYZcb{}}\PY{p}{,}\PY{p}{\PYZob{}}\PY{p}{\PYZcb{}}
\PY{k}{def} \PY{n+nf}{negative\PYZus{}tcopula\PYZus{}log\PYZus{}likelihood}\PY{p}{(}\PY{n}{nu}\PY{p}{,}\PY{n}{corr}\PY{p}{,}\PY{n}{x}\PY{p}{)}\PY{p}{:}
    \PY{n}{copula} \PY{o}{=} \PY{n}{StudentTCopula}\PY{p}{(}\PY{n}{corr}\PY{o}{=}\PY{n}{corr}\PY{p}{,}\PY{n}{df} \PY{o}{=} \PY{n}{nu}\PY{p}{,} \PY{n}{k\PYZus{}dim}\PY{o}{=}\PY{n}{corr}\PY{o}{.}\PY{n}{shape}\PY{p}{[}\PY{l+m+mi}{0}\PY{p}{]}\PY{p}{)}
    \PY{k}{return} \PY{o}{\PYZhy{}}\PY{l+m+mi}{1}\PY{o}{*}\PY{n+nb}{sum}\PY{p}{(}\PY{n}{copula}\PY{o}{.}\PY{n}{logpdf}\PY{p}{(}\PY{n}{row}\PY{p}{)} \PY{k}{for} \PY{n}{row} \PY{o+ow}{in} \PY{n}{x}\PY{p}{)}
\PY{n}{options} \PY{o}{=} \PY{p}{\PYZob{}}\PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{maxiter}\PY{l+s+s1}{\PYZsq{}}\PY{p}{:} \PY{l+m+mi}{10000}\PY{p}{,} \PY{c+c1}{\PYZsh{}Max iterations}
            \PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{gtol}\PY{l+s+s1}{\PYZsq{}}\PY{p}{:} \PY{l+m+mf}{1e\PYZhy{}12}\PY{p}{,} \PY{c+c1}{\PYZsh{}Tolerance for convergence}
            \PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{disp}\PY{l+s+s1}{\PYZsq{}}\PY{p}{:} \PY{k+kc}{True} \PY{p}{\PYZcb{}} \PY{c+c1}{\PYZsh{}Display warnings}
\PY{k}{for} \PY{n}{dist} \PY{o+ow}{in} \PY{n}{distributions}\PY{p}{:}
    \PY{n}{t\PYZus{}model} \PY{o}{=} \PY{n}{t}\PY{o}{.}\PY{n}{fit}\PY{p}{(}\PY{n}{std\PYZus{}residuals}\PY{p}{[}\PY{n}{dist}\PY{p}{]}\PY{o}{.}\PY{n}{to\PYZus{}numpy}\PY{p}{(}\PY{p}{)}\PY{p}{)}
    \PY{n}{u}\PY{p}{[}\PY{n}{dist}\PY{p}{]} \PY{o}{=} \PY{n}{t}\PY{o}{.}\PY{n}{cdf}\PY{p}{(}\PY{n}{std\PYZus{}residuals}\PY{p}{[}\PY{n}{dist}\PY{p}{]}\PY{o}{.}\PY{n}{to\PYZus{}numpy}\PY{p}{(}\PY{p}{)}\PY{p}{,}\PY{n}{t\PYZus{}model}\PY{p}{[}\PY{l+m+mi}{0}\PY{p}{]}\PY{p}{,}\PY{n}{t\PYZus{}model}\PY{p}{[}\PY{l+m+mi}{1}\PY{p}{]}\PY{p}{,}\PY{n}{t\PYZus{}model}\PY{p}{[}\PY{l+m+mi}{2}\PY{p}{]}\PY{p}{)}
    \PY{n}{fitted\PYZus{}df}\PY{p}{[}\PY{n}{dist}\PY{p}{]} \PY{o}{=} \PY{n}{minimize}\PY{p}{(}\PY{n}{negative\PYZus{}tcopula\PYZus{}log\PYZus{}likelihood}\PY{p}{,}\PY{l+m+mi}{10}\PY{p}{,} \PY{n}{args} \PY{o}{=} \PY{p}{(}\PY{n}{spearman\PYZus{}cov}\PY{p}{[}\PY{n}{dist}\PY{p}{]}\PY{p}{,}\PY{n}{u}\PY{p}{[}\PY{n}{dist}\PY{p}{]}\PY{p}{)}\PY{p}{,}\PY{n}{bounds} \PY{o}{=} \PY{p}{[}\PY{p}{(}\PY{l+m+mi}{2}\PY{p}{,}\PY{l+m+mi}{1000}\PY{p}{)}\PY{p}{]}\PY{p}{,}\PY{n}{options} \PY{o}{=} \PY{n}{options}\PY{p}{)}\PY{o}{.}\PY{n}{x}
\PY{n}{display}\PY{p}{(}\PY{n}{pd}\PY{o}{.}\PY{n}{DataFrame}\PY{p}{(}\PY{n}{fitted\PYZus{}df}\PY{p}{,}\PY{n}{index}\PY{o}{=}\PY{p}{[}\PY{l+s+s2}{\PYZdq{}}\PY{l+s+s2}{Fitted df}\PY{l+s+s2}{\PYZdq{}}\PY{p}{]}\PY{p}{)}\PY{p}{)}
\end{Verbatim}
\end{tcolorbox}

    
    \begin{Verbatim}[commandchars=\\\{\}]
              normal          t      skewt
Fitted df  11.335846  11.031743  11.044519
    \end{Verbatim}

    
    \paragraph{Sampling Procedure}\label{sampling-procedure}

Following the procedure in ``Copula Methods in Finance'', we can sample
from our Student's t-copula using the following algorithm:

\begin{enumerate}
\def\labelenumi{\arabic{enumi}.}
\tightlist
\item
  Find the Choelsky Decomposition A of R, where R is our Spearman Corr.
  Matrix
\item
  Simulate \(n\) i.i.d. \(N(0,1)\) random variables \(z_i\), set
  \(z=(z_1,z_2,...,z_n)\)
\item
  Set \(X = Az\)
\item
  Simulate \(s\sim\chi^2_\nu\) independently of \(z\)
\item
  Set \(x = \sqrt{\frac{\nu}{s}}y\)
\item
  Set \(u_i = F_\nu (x_i)\) for \(i=1,2,...,n\) where \(F_nu\)
  represents the univariate Student's t c.d.f. with \(\nu\) degrees of
  freedom
\end{enumerate}

We can then set \(t_i = F^{-1}_i (u_i)\) for \(i=1,2,...,n\) where
\(F_i^{-1}\) represents the inverse c.d.f for \(T_i\). Here, each
\(t_i\) represents a simulated standardized residual. Conveniently, the
statsmodels StudentTCopula class allows us to sample from our copula
directly. We will use this instead to conduct 100,000 samples from our
copula. Then, applying the marginal inverse c.d.f's component wise, we
get 100,000 simulations for our standardized residuals.

    \begin{tcolorbox}[breakable, size=fbox, boxrule=1pt, pad at break*=1mm,colback=cellbackground, colframe=cellborder]
\prompt{In}{incolor}{13}{\boxspacing}
\begin{Verbatim}[commandchars=\\\{\}]
\PY{n}{copulas} \PY{o}{=} \PY{p}{\PYZob{}}\PY{n}{dist}\PY{p}{:} \PY{n}{StudentTCopula}\PY{p}{(}\PY{n}{corr}\PY{o}{=}\PY{n}{spearman\PYZus{}cov}\PY{p}{[}\PY{n}{dist}\PY{p}{]}\PY{p}{,}
                                \PY{n}{df} \PY{o}{=} \PY{n}{fitted\PYZus{}df}\PY{p}{[}\PY{n}{dist}\PY{p}{]}\PY{p}{,} 
                                \PY{n}{k\PYZus{}dim}\PY{o}{=}\PY{n}{spearman\PYZus{}cov}\PY{p}{[}\PY{n}{dist}\PY{p}{]}\PY{o}{.}\PY{n}{shape}\PY{p}{[}\PY{l+m+mi}{0}\PY{p}{]}\PY{p}{)} \PY{k}{for} \PY{n}{dist} \PY{o+ow}{in} \PY{n}{distributions}\PY{p}{\PYZcb{}}

\PY{k}{def} \PY{n+nf}{inverse\PYZus{}marginal}\PY{p}{(}\PY{n}{x}\PY{p}{,}\PY{n}{dist}\PY{p}{)}\PY{p}{:} \PY{c+c1}{\PYZsh{}given a vector of quantiles, return inverse}
    \PY{n}{marginals} \PY{o}{=} \PY{p}{[}\PY{p}{]}
    \PY{k}{for} \PY{n}{ticker} \PY{o+ow}{in} \PY{n}{tickers}\PY{p}{:}
        \PY{k}{if} \PY{n}{dist} \PY{o}{==} \PY{l+s+s2}{\PYZdq{}}\PY{l+s+s2}{normal}\PY{l+s+s2}{\PYZdq{}} \PY{p}{:} \PY{n}{marginals}\PY{o}{.}\PY{n}{append}\PY{p}{(}\PY{n}{norm}\PY{o}{.}\PY{n}{ppf}\PY{p}{(}\PY{n}{x}\PY{p}{[}\PY{p}{:}\PY{p}{,}\PY{n}{tickers}\PY{o}{.}\PY{n}{index}\PY{p}{(}\PY{n}{ticker}\PY{p}{)}\PY{p}{]}\PY{p}{)}\PY{p}{)}
        \PY{k}{elif} \PY{n}{dist} \PY{o}{==} \PY{l+s+s2}{\PYZdq{}}\PY{l+s+s2}{t}\PY{l+s+s2}{\PYZdq{}}\PY{p}{:} \PY{n}{marginals}\PY{o}{.}\PY{n}{append}\PY{p}{(}\PY{n}{t}\PY{o}{.}\PY{n}{ppf}\PY{p}{(}\PY{n}{x}\PY{p}{[}\PY{p}{:}\PY{p}{,}\PY{n}{tickers}\PY{o}{.}\PY{n}{index}\PY{p}{(}\PY{n}{ticker}\PY{p}{)}\PY{p}{]}\PY{p}{,}\PY{n}{df} \PY{o}{=} \PY{n}{params}\PY{p}{[}\PY{n}{dist}\PY{p}{]}\PY{p}{[}\PY{n}{ticker}\PY{p}{]}\PY{p}{[}\PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{nu}\PY{l+s+s1}{\PYZsq{}}\PY{p}{]}\PY{p}{)}\PY{p}{)}
        \PY{k}{elif} \PY{n}{dist} \PY{o}{==} \PY{l+s+s2}{\PYZdq{}}\PY{l+s+s2}{skewt}\PY{l+s+s2}{\PYZdq{}}\PY{p}{:} \PY{n}{marginals}\PY{o}{.}\PY{n}{append}\PY{p}{(}\PY{p}{(}\PY{n}{SkewStudent}\PY{p}{(}\PY{p}{)}\PY{o}{.}\PY{n}{ppf}\PY{p}{(}\PY{n}{pits} \PY{o}{=} \PY{n}{x}\PY{p}{[}\PY{p}{:}\PY{p}{,}\PY{n}{tickers}\PY{o}{.}\PY{n}{index}\PY{p}{(}\PY{n}{ticker}\PY{p}{)}\PY{p}{]}\PY{p}{,}
                                    \PY{n}{parameters}\PY{o}{=}\PY{p}{[}\PY{n}{params}\PY{p}{[}\PY{n}{dist}\PY{p}{]}\PY{p}{[}\PY{n}{ticker}\PY{p}{]}\PY{p}{[}\PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{eta}\PY{l+s+s1}{\PYZsq{}}\PY{p}{]}\PY{p}{,}\PY{n}{params}\PY{p}{[}\PY{n}{dist}\PY{p}{]}\PY{p}{[}\PY{n}{ticker}\PY{p}{]}\PY{p}{[}\PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{lambda}\PY{l+s+s1}{\PYZsq{}}\PY{p}{]}\PY{p}{]}\PY{p}{)}\PY{p}{)}\PY{p}{)}
    \PY{k}{return} \PY{n}{pd}\PY{o}{.}\PY{n}{DataFrame}\PY{p}{(}\PY{n}{np}\PY{o}{.}\PY{n}{array}\PY{p}{(}\PY{n}{marginals}\PY{p}{)}\PY{o}{.}\PY{n}{T}\PY{p}{,}\PY{n}{columns} \PY{o}{=} \PY{n}{tickers}\PY{p}{)}

\PY{k}{def} \PY{n+nf}{get\PYZus{}simulated\PYZus{}t}\PY{p}{(}\PY{n}{dist}\PY{p}{,} \PY{n}{num\PYZus{}samples} \PY{o}{=} \PY{l+m+mi}{100000}\PY{p}{)}\PY{p}{:} \PY{c+c1}{\PYZsh{}function to create samples from our copula, and convert to marginals}
    \PY{k}{return} \PY{n}{inverse\PYZus{}marginal}\PY{p}{(}\PY{n}{copulas}\PY{p}{[}\PY{n}{dist}\PY{p}{]}\PY{o}{.}\PY{n}{rvs}\PY{p}{(}\PY{n}{num\PYZus{}samples}\PY{p}{)}\PY{p}{,}\PY{n}{dist}\PY{p}{)}
\end{Verbatim}
\end{tcolorbox}

    \paragraph{Plot QQ Plot for marginal copula
samples}\label{plot-qq-plot-for-marginal-copula-samples}

We will plot QQplots of our marginal samples drawn from our copula,
compared to our GARCH residuals. We expect there to be a strong fit, as
our copula is fitted to the transformed residuals.

    \begin{tcolorbox}[breakable, size=fbox, boxrule=1pt, pad at break*=1mm,colback=cellbackground, colframe=cellborder]
\prompt{In}{incolor}{14}{\boxspacing}
\begin{Verbatim}[commandchars=\\\{\}]
\PY{n}{num\PYZus{}samples} \PY{o}{=} \PY{l+m+mi}{100000}
\PY{n}{fig}\PY{p}{,} \PY{n}{axes} \PY{o}{=} \PY{n}{plt}\PY{o}{.}\PY{n}{subplots}\PY{p}{(}\PY{l+m+mi}{3}\PY{p}{,} \PY{n+nb}{len}\PY{p}{(}\PY{n}{tickers}\PY{p}{)}\PY{p}{,} \PY{n}{figsize}\PY{o}{=}\PY{p}{(}\PY{l+m+mi}{5} \PY{o}{*} \PY{n+nb}{len}\PY{p}{(}\PY{n}{tickers}\PY{p}{)}\PY{p}{,} \PY{l+m+mi}{5}\PY{o}{*}\PY{l+m+mi}{3}\PY{p}{)}\PY{p}{)}
\PY{k}{for} \PY{n}{i} \PY{o+ow}{in} \PY{n+nb}{range}\PY{p}{(}\PY{n+nb}{len}\PY{p}{(}\PY{n}{distributions}\PY{p}{)}\PY{p}{)}\PY{p}{:}
    \PY{n}{n} \PY{o}{=} \PY{l+m+mi}{300}
    \PY{n}{quantiles} \PY{o}{=} \PY{p}{(}\PY{n}{np}\PY{o}{.}\PY{n}{arange}\PY{p}{(}\PY{l+m+mi}{1}\PY{p}{,} \PY{n}{n} \PY{o}{+} \PY{l+m+mi}{1}\PY{p}{)} \PY{o}{\PYZhy{}} \PY{l+m+mf}{0.5}\PY{p}{)} \PY{o}{/} \PY{n}{n}
     \PY{c+c1}{\PYZsh{}Get simulated results for comparison}

    \PY{k}{for} \PY{n}{j} \PY{o+ow}{in} \PY{n+nb}{range}\PY{p}{(}\PY{n+nb}{len}\PY{p}{(}\PY{n}{tickers}\PY{p}{)}\PY{p}{)}\PY{p}{:}
        \PY{n}{dist}\PY{p}{,} \PY{n}{ticker}\PY{p}{,} \PY{n}{theoretical\PYZus{}quantiles} \PY{o}{=} \PY{n}{distributions}\PY{p}{[}\PY{n}{i}\PY{p}{]}\PY{p}{,} \PY{n}{tickers}\PY{p}{[}\PY{n}{j}\PY{p}{]}\PY{p}{,} \PY{p}{[}\PY{p}{]}
        \PY{k}{if} \PY{n}{dist} \PY{o}{==} \PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{normal}\PY{l+s+s1}{\PYZsq{}}\PY{p}{:} \PY{n}{theoretical\PYZus{}quantiles} \PY{o}{=}  \PY{n}{np}\PY{o}{.}\PY{n}{quantile}\PY{p}{(}\PY{n}{norm}\PY{o}{.}\PY{n}{rvs}\PY{p}{(}\PY{l+m+mi}{0}\PY{p}{,}\PY{l+m+mi}{1}\PY{p}{,}\PY{n}{num\PYZus{}samples}\PY{p}{)}\PY{p}{,} \PY{n}{quantiles}\PY{p}{)}
        \PY{k}{elif} \PY{n}{dist} \PY{o}{==} \PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{t}\PY{l+s+s1}{\PYZsq{}}\PY{p}{:}\PY{n}{theoretical\PYZus{}quantiles} \PY{o}{=}  \PY{n}{np}\PY{o}{.}\PY{n}{quantile}\PY{p}{(}\PY{n}{t}\PY{o}{.}\PY{n}{rvs}\PY{p}{(}\PY{n}{params}\PY{p}{[}\PY{n}{dist}\PY{p}{]}\PY{p}{[}\PY{n}{ticker}\PY{p}{]}\PY{p}{[}\PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{nu}\PY{l+s+s1}{\PYZsq{}}\PY{p}{]}\PY{p}{,}\PY{l+m+mi}{0}\PY{p}{,}\PY{l+m+mi}{1}\PY{p}{,}\PY{n}{num\PYZus{}samples}\PY{p}{)}\PY{p}{,} \PY{n}{quantiles}\PY{p}{)}
        \PY{k}{elif} \PY{n}{dist} \PY{o}{==} \PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{skewt}\PY{l+s+s1}{\PYZsq{}}\PY{p}{:}  
            \PY{n}{skew\PYZus{}t\PYZus{}rvs} \PY{o}{=} \PY{n}{SkewStudent}\PY{p}{(}\PY{p}{)}\PY{o}{.}\PY{n}{simulate}\PY{p}{(}\PY{n}{parameters}\PY{o}{=}\PY{p}{[}\PY{n}{params}\PY{p}{[}\PY{n}{dist}\PY{p}{]}\PY{p}{[}\PY{n}{ticker}\PY{p}{]}\PY{p}{[}\PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{eta}\PY{l+s+s1}{\PYZsq{}}\PY{p}{]}\PY{p}{,} \PY{n}{params}\PY{p}{[}\PY{n}{dist}\PY{p}{]}\PY{p}{[}\PY{n}{ticker}\PY{p}{]}\PY{p}{[}\PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{lambda}\PY{l+s+s1}{\PYZsq{}}\PY{p}{]}\PY{p}{]}\PY{p}{)}
            \PY{n}{theoretical\PYZus{}quantiles}  \PY{o}{=}  \PY{n}{np}\PY{o}{.}\PY{n}{quantile}\PY{p}{(}\PY{n}{skew\PYZus{}t\PYZus{}rvs}\PY{p}{(}\PY{n}{num\PYZus{}samples}\PY{p}{)}\PY{p}{,} \PY{n}{quantiles}\PY{p}{)}

        \PY{n}{simulated\PYZus{}quantiles} \PY{o}{=} \PY{n}{np}\PY{o}{.}\PY{n}{quantile}\PY{p}{(}\PY{n}{get\PYZus{}simulated\PYZus{}t}\PY{p}{(}\PY{n}{dist}\PY{p}{)}\PY{p}{,}\PY{n}{quantiles}\PY{p}{)}
        \PY{n}{axes}\PY{p}{[}\PY{n}{i}\PY{p}{]}\PY{p}{[}\PY{n}{j}\PY{p}{]}\PY{o}{.}\PY{n}{plot}\PY{p}{(}\PY{n}{theoretical\PYZus{}quantiles}\PY{p}{,}\PY{n}{theoretical\PYZus{}quantiles}\PY{p}{,}\PY{n}{color} \PY{o}{=} \PY{l+s+s2}{\PYZdq{}}\PY{l+s+s2}{red}\PY{l+s+s2}{\PYZdq{}}\PY{p}{)}
        \PY{n}{axes}\PY{p}{[}\PY{n}{i}\PY{p}{]}\PY{p}{[}\PY{n}{j}\PY{p}{]}\PY{o}{.}\PY{n}{scatter}\PY{p}{(}\PY{n}{theoretical\PYZus{}quantiles}\PY{p}{,}\PY{n}{simulated\PYZus{}quantiles}\PY{p}{,}\PY{n}{color} \PY{o}{=} \PY{l+s+s2}{\PYZdq{}}\PY{l+s+s2}{blue}\PY{l+s+s2}{\PYZdq{}}\PY{p}{,} \PY{n}{marker} \PY{o}{=} \PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{o}\PY{l+s+s1}{\PYZsq{}}\PY{p}{)}
        \PY{n}{axes}\PY{p}{[}\PY{n}{i}\PY{p}{]}\PY{p}{[}\PY{n}{j}\PY{p}{]}\PY{o}{.}\PY{n}{set\PYZus{}xlim}\PY{p}{(}\PY{o}{\PYZhy{}}\PY{l+m+mi}{3}\PY{p}{,}\PY{l+m+mi}{3}\PY{p}{)}
        \PY{n}{axes}\PY{p}{[}\PY{n}{i}\PY{p}{]}\PY{p}{[}\PY{n}{j}\PY{p}{]}\PY{o}{.}\PY{n}{set\PYZus{}ylim}\PY{p}{(}\PY{o}{\PYZhy{}}\PY{l+m+mi}{3}\PY{p}{,}\PY{l+m+mi}{3}\PY{p}{)}
        \PY{n}{axes}\PY{p}{[}\PY{n}{i}\PY{p}{]}\PY{p}{[}\PY{n}{j}\PY{p}{]}\PY{o}{.}\PY{n}{set\PYZus{}title}\PY{p}{(}\PY{n}{ticker}\PY{o}{+}\PY{n+nb}{str}\PY{p}{(}\PY{l+s+s2}{\PYZdq{}}\PY{l+s+s2}{ \PYZhy{} Dist: }\PY{l+s+s2}{\PYZdq{}}\PY{o}{+}\PY{n}{dist}\PY{p}{)}\PY{p}{)} 
    \PY{n}{plt}\PY{o}{.}\PY{n}{tight\PYZus{}layout}\PY{p}{(}\PY{p}{)}
\end{Verbatim}
\end{tcolorbox}

    \begin{center}
    \adjustimage{max size={0.9\linewidth}{0.9\paperheight}}{program_files/program_39_0.png}
    \end{center}
    { \hspace*{\fill} \\}
    
    At least on a marginal level, our copula accurately models the
standardized residuals from our GARCH models.

    \section{Forecasting}\label{forecasting}

    \subsection{Forecast One Period
Return}\label{forecast-one-period-return}

We can forecast the one period ahead return as follows:\\
1. Forecast the conditional volatility of each index using our GARCH
models.\\
2. Multiply our n-simulated standardized residuals by our conditional
volatility forecasts - this gives n raw residual simulations for each
index.\\
3. Add our mean log-return to each residual forecast - this yields a
one-period ahead forecast for each index, following our dependence
structure.

    \begin{tcolorbox}[breakable, size=fbox, boxrule=1pt, pad at break*=1mm,colback=cellbackground, colframe=cellborder]
\prompt{In}{incolor}{15}{\boxspacing}
\begin{Verbatim}[commandchars=\\\{\}]
\PY{n}{forecast\PYZus{}dfs} \PY{o}{=} \PY{p}{\PYZob{}}\PY{p}{\PYZcb{}}

\PY{k}{def} \PY{n+nf}{compute\PYZus{}forecast}\PY{p}{(}\PY{n}{dist}\PY{p}{,} \PY{n}{cond\PYZus{}vol\PYZus{}index} \PY{o}{=} \PY{o}{\PYZhy{}}\PY{l+m+mi}{1}\PY{p}{,} \PY{n}{num\PYZus{}samples} \PY{o}{=} \PY{l+m+mi}{10000}\PY{p}{)}\PY{p}{:}
    \PY{n}{forecasts} \PY{o}{=} \PY{p}{\PYZob{}}\PY{p}{\PYZcb{}}
    \PY{n}{simulated\PYZus{}results} \PY{o}{=} \PY{n}{get\PYZus{}simulated\PYZus{}t}\PY{p}{(}\PY{n}{dist}\PY{p}{,}\PY{n}{num\PYZus{}samples}\PY{p}{)}
    \PY{k}{for} \PY{n}{ticker} \PY{o+ow}{in} \PY{n}{tickers}\PY{p}{:}
        \PY{n}{forecasts}\PY{p}{[}\PY{n}{ticker}\PY{p}{]} \PY{o}{=} \PY{n}{params}\PY{p}{[}\PY{n}{dist}\PY{p}{]}\PY{p}{[}\PY{n}{ticker}\PY{p}{]}\PY{p}{[}\PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{mu}\PY{l+s+s1}{\PYZsq{}}\PY{p}{]}\PY{o}{/}\PY{l+m+mi}{100} \PY{o}{+}\PYZbs{}
                \PY{n}{simulated\PYZus{}results}\PY{p}{[}\PY{n}{ticker}\PY{p}{]}\PY{o}{*}\PYZbs{}
                \PY{n}{fitted\PYZus{}models}\PY{p}{[}\PY{n}{dist}\PY{p}{]}\PY{p}{[}\PY{n}{ticker}\PY{p}{]}\PY{o}{.}\PY{n}{conditional\PYZus{}volatility}\PY{o}{.}\PY{n}{iloc}\PY{p}{[}\PY{n}{cond\PYZus{}vol\PYZus{}index}\PY{p}{]}\PY{o}{/}\PY{l+m+mi}{100}
    \PY{k}{return} \PY{n}{pd}\PY{o}{.}\PY{n}{DataFrame}\PY{p}{(}\PY{n}{forecasts}\PY{p}{)}

\PY{n}{strikes} \PY{o}{=} \PY{p}{[}\PY{l+m+mf}{0.01}\PY{p}{,}\PY{l+m+mf}{0.02}\PY{p}{,}\PY{l+m+mf}{0.03}\PY{p}{,}\PY{l+m+mf}{0.04}\PY{p}{,}\PY{l+m+mf}{0.05}\PY{p}{]}
\PY{n}{simulated\PYZus{}prices} \PY{o}{=} \PY{n}{pd}\PY{o}{.}\PY{n}{DataFrame}\PY{p}{(}\PY{n}{index} \PY{o}{=} \PY{n}{strikes}\PY{p}{,} \PY{n}{columns} \PY{o}{=} \PY{p}{[}\PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{normal}\PY{l+s+s1}{\PYZsq{}}\PY{p}{,}\PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{t}\PY{l+s+s1}{\PYZsq{}}\PY{p}{,}\PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{skewt}\PY{l+s+s1}{\PYZsq{}}\PY{p}{]}\PY{p}{)}
\PY{n}{simulated\PYZus{}prices}\PY{o}{.}\PY{n}{index}\PY{o}{.}\PY{n}{name} \PY{o}{=} \PY{l+s+s2}{\PYZdq{}}\PY{l+s+s2}{strike}\PY{l+s+s2}{\PYZdq{}}
\PY{n}{fig}\PY{p}{,} \PY{n}{axes} \PY{o}{=} \PY{n}{plt}\PY{o}{.}\PY{n}{subplots}\PY{p}{(}\PY{l+m+mi}{1}\PY{p}{,} \PY{l+m+mi}{3}\PY{p}{,} \PY{n}{figsize}\PY{o}{=}\PY{p}{(}\PY{l+m+mi}{3} \PY{o}{*} \PY{l+m+mi}{3}\PY{p}{,} \PY{l+m+mi}{3}\PY{p}{)}\PY{p}{)}

\PY{k}{for} \PY{n}{dist} \PY{o+ow}{in} \PY{n}{distributions}\PY{p}{:}
    \PY{n}{forecasts} \PY{o}{=} \PY{n}{compute\PYZus{}forecast}\PY{p}{(}\PY{n}{dist}\PY{p}{,}\PY{o}{\PYZhy{}}\PY{l+m+mi}{1} \PY{p}{)}
    \PY{n}{forecast\PYZus{}dfs}\PY{p}{[}\PY{n}{dist}\PY{p}{]} \PY{o}{=} \PY{n}{np}\PY{o}{.}\PY{n}{exp}\PY{p}{(}\PY{n}{pd}\PY{o}{.}\PY{n}{DataFrame}\PY{p}{(}\PY{n}{forecasts}\PY{p}{)}\PY{p}{)} \PY{o}{\PYZhy{}} \PY{l+m+mi}{1} \PY{c+c1}{\PYZsh{}convert to simple returns for computing payoff}
    \PY{c+c1}{\PYZsh{}Compute and plot basket returns}
    \PY{n}{forecast\PYZus{}dfs}\PY{p}{[}\PY{n}{dist}\PY{p}{]}\PY{p}{[}\PY{l+s+s2}{\PYZdq{}}\PY{l+s+s2}{Average}\PY{l+s+s2}{\PYZdq{}}\PY{p}{]} \PY{o}{=} \PY{n}{forecast\PYZus{}dfs}\PY{p}{[}\PY{n}{dist}\PY{p}{]}\PY{o}{.}\PY{n}{mean}\PY{p}{(}\PY{n}{axis}\PY{o}{=}\PY{l+m+mi}{1}\PY{p}{)} 
    \PY{n}{axes}\PY{p}{[}\PY{n}{distributions}\PY{o}{.}\PY{n}{index}\PY{p}{(}\PY{n}{dist}\PY{p}{)}\PY{p}{]}\PY{o}{.}\PY{n}{hist}\PY{p}{(}\PY{n}{forecast\PYZus{}dfs}\PY{p}{[}\PY{n}{dist}\PY{p}{]}\PY{p}{[}\PY{l+s+s2}{\PYZdq{}}\PY{l+s+s2}{Average}\PY{l+s+s2}{\PYZdq{}}\PY{p}{]}\PY{p}{,} \PY{n}{density} \PY{o}{=} \PY{k+kc}{True}\PY{p}{,} \PY{n}{bins} \PY{o}{=} \PY{l+m+mi}{20}\PY{p}{)}
    \PY{n}{axes}\PY{p}{[}\PY{n}{distributions}\PY{o}{.}\PY{n}{index}\PY{p}{(}\PY{n}{dist}\PY{p}{)}\PY{p}{]}\PY{o}{.}\PY{n}{set\PYZus{}title}\PY{p}{(}\PY{n}{dist}\PY{p}{)}
    \PY{c+c1}{\PYZsh{}Compute simulated payoffs}
    \PY{k}{for} \PY{n}{k} \PY{o+ow}{in} \PY{n}{strikes}\PY{p}{:}
        \PY{n}{simulated\PYZus{}prices}\PY{o}{.}\PY{n}{loc}\PY{p}{[}\PY{n}{k}\PY{p}{,}\PY{n}{dist}\PY{p}{]} \PY{o}{=} \PY{n}{np}\PY{o}{.}\PY{n}{maximum}\PY{p}{(}\PY{n}{forecast\PYZus{}dfs}\PY{p}{[}\PY{n}{dist}\PY{p}{]}\PY{p}{[}\PY{l+s+s2}{\PYZdq{}}\PY{l+s+s2}{Average}\PY{l+s+s2}{\PYZdq{}}\PY{p}{]} \PY{o}{\PYZhy{}} \PY{n}{k}\PY{p}{,}\PY{l+m+mi}{0}\PY{p}{)}\PY{o}{.}\PY{n}{mean}\PY{p}{(}\PY{p}{)}

\PY{n}{display}\PY{p}{(}\PY{n}{pd}\PY{o}{.}\PY{n}{DataFrame}\PY{p}{(}\PY{p}{[}\PY{n}{forecast\PYZus{}dfs}\PY{p}{[}\PY{n}{dist}\PY{p}{]}\PY{p}{[}\PY{l+s+s2}{\PYZdq{}}\PY{l+s+s2}{Average}\PY{l+s+s2}{\PYZdq{}}\PY{p}{]}\PY{o}{.}\PY{n}{mean}\PY{p}{(}\PY{p}{)} \PY{k}{for} \PY{n}{dist} \PY{o+ow}{in} \PY{n}{distributions}\PY{p}{]}\PY{p}{,} \PY{n}{distributions}\PY{p}{,} \PY{n}{columns} \PY{o}{=} \PY{p}{[}\PY{l+s+s2}{\PYZdq{}}\PY{l+s+s2}{Simulated Mean Returns:}\PY{l+s+s2}{\PYZdq{}}\PY{p}{]}\PY{p}{)}\PY{p}{)}

\PY{n+nb}{print}\PY{p}{(}\PY{l+s+s2}{\PYZdq{}}\PY{l+s+s2}{Simulated Mean Option Payoffs:}\PY{l+s+s2}{\PYZdq{}}\PY{p}{,}\PY{n}{end} \PY{o}{=} \PY{l+s+s2}{\PYZdq{}}\PY{l+s+s2}{\PYZdq{}}\PY{p}{)}
\PY{n}{display}\PY{p}{(}\PY{n}{simulated\PYZus{}prices}\PY{p}{)}

\PY{n+nb}{print}\PY{p}{(}\PY{l+s+s2}{\PYZdq{}}\PY{l+s+s2}{Simulated Density of Simple Returns:}\PY{l+s+s2}{\PYZdq{}}\PY{p}{)}
\PY{n}{plt}\PY{o}{.}\PY{n}{show}\PY{p}{(}\PY{p}{)}
\end{Verbatim}
\end{tcolorbox}

    
    \begin{Verbatim}[commandchars=\\\{\}]
        Simulated Mean Returns:
normal                 0.007969
t                      0.008981
skewt                  0.007052
    \end{Verbatim}

    
    \begin{Verbatim}[commandchars=\\\{\}]
Simulated Mean Option Payoffs:
    \end{Verbatim}

    
    \begin{Verbatim}[commandchars=\\\{\}]
          normal         t     skewt
strike                              
0.01    0.011895  0.013408  0.010567
0.02    0.007815  0.009205  0.006386
0.03    0.004868  0.006115  0.003539
0.04    0.002888  0.003954  0.001823
0.05    0.001623  0.002502  0.000885
    \end{Verbatim}

    
    \begin{Verbatim}[commandchars=\\\{\}]
Simulated Density of Simple Returns:
    \end{Verbatim}

    \begin{center}
    \adjustimage{max size={0.9\linewidth}{0.9\paperheight}}{program_files/program_43_4.png}
    \end{center}
    { \hspace*{\fill} \\}
    
    \subsection{Historical Payoffs}\label{historical-payoffs}

Here we compute the historical payoff of our basket option, for various
strikes, at each month in our dataset.

    \begin{tcolorbox}[breakable, size=fbox, boxrule=1pt, pad at break*=1mm,colback=cellbackground, colframe=cellborder]
\prompt{In}{incolor}{17}{\boxspacing}
\begin{Verbatim}[commandchars=\\\{\}]
\PY{n}{merged\PYZus{}data}\PY{p}{[}\PY{l+s+s2}{\PYZdq{}}\PY{l+s+s2}{Simple Average Return}\PY{l+s+s2}{\PYZdq{}}\PY{p}{]} \PY{o}{=} \PY{n}{np}\PY{o}{.}\PY{n}{exp}\PY{p}{(}\PY{n}{merged\PYZus{}data}\PY{p}{[}\PY{n}{tickers}\PY{p}{]}\PY{p}{)}\PY{o}{.}\PY{n}{mean}\PY{p}{(}\PY{n}{axis}\PY{o}{=}\PY{l+m+mi}{1}\PY{p}{)} \PY{o}{\PYZhy{}} \PY{l+m+mi}{1}

\PY{n+nb}{print}\PY{p}{(}\PY{l+s+s2}{\PYZdq{}}\PY{l+s+s2}{Empirical Average Simple Return:}\PY{l+s+s2}{\PYZdq{}}\PY{p}{,}\PY{n+nb}{str}\PY{p}{(}\PY{n}{merged\PYZus{}data}\PY{p}{[}\PY{l+s+s2}{\PYZdq{}}\PY{l+s+s2}{Simple Average Return}\PY{l+s+s2}{\PYZdq{}}\PY{p}{]}\PY{o}{.}\PY{n}{mean}\PY{p}{(}\PY{p}{)}\PY{p}{)}\PY{p}{)}
\PY{k}{for} \PY{n}{k} \PY{o+ow}{in} \PY{n}{strikes}\PY{p}{:} \PY{n}{merged\PYZus{}data}\PY{p}{[}\PY{l+s+s2}{\PYZdq{}}\PY{l+s+s2}{Basket Payoff, strike:}\PY{l+s+s2}{\PYZdq{}}\PY{p}{,}\PY{n}{k}\PY{p}{]} \PY{o}{=} \PY{n}{np}\PY{o}{.}\PY{n}{maximum}\PY{p}{(}\PY{n}{merged\PYZus{}data}\PY{p}{[}\PY{l+s+s2}{\PYZdq{}}\PY{l+s+s2}{Simple Average Return}\PY{l+s+s2}{\PYZdq{}}\PY{p}{]} \PY{o}{\PYZhy{}} \PY{n}{k}\PY{p}{,}\PY{l+m+mi}{0}\PY{p}{)}

\PY{n}{display}\PY{p}{(}\PY{n}{pd}\PY{o}{.}\PY{n}{DataFrame}\PY{p}{(}\PY{p}{[}\PY{n}{merged\PYZus{}data}\PY{p}{[}\PY{l+s+s2}{\PYZdq{}}\PY{l+s+s2}{Basket Payoff, strike:}\PY{l+s+s2}{\PYZdq{}}\PY{p}{,}\PY{n}{k}\PY{p}{]}\PY{o}{.}\PY{n}{mean}\PY{p}{(}\PY{p}{)} \PY{k}{for} \PY{n}{k} \PY{o+ow}{in} \PY{n}{strikes}\PY{p}{]}\PY{p}{,}\PY{n}{index}\PY{o}{=}\PY{n}{pd}\PY{o}{.}\PY{n}{Index}\PY{p}{(}\PY{n}{strikes}\PY{p}{,}\PY{n}{name} \PY{o}{=} \PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{Strike}\PY{l+s+s1}{\PYZsq{}}\PY{p}{)}\PY{p}{,} \PY{n}{columns} \PY{o}{=} \PY{p}{[}\PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{Historical Avg. Payoff}\PY{l+s+s1}{\PYZsq{}}\PY{p}{]}\PY{p}{)}\PY{p}{)}

\PY{n}{fig}\PY{p}{,} \PY{n}{axes} \PY{o}{=} \PY{n}{plt}\PY{o}{.}\PY{n}{subplots}\PY{p}{(}\PY{l+m+mi}{1}\PY{p}{,} \PY{l+m+mi}{2}\PY{p}{,} \PY{n}{figsize}\PY{o}{=}\PY{p}{(}\PY{l+m+mi}{5} \PY{o}{*} \PY{l+m+mi}{2}\PY{p}{,} \PY{l+m+mi}{5}\PY{p}{)}\PY{p}{)}

\PY{n}{axes}\PY{p}{[}\PY{l+m+mi}{0}\PY{p}{]}\PY{o}{.}\PY{n}{plot}\PY{p}{(}\PY{n}{merged\PYZus{}data}\PY{p}{[}\PY{l+s+s2}{\PYZdq{}}\PY{l+s+s2}{Simple Average Return}\PY{l+s+s2}{\PYZdq{}}\PY{p}{]}\PY{p}{)}
\PY{n}{axes}\PY{p}{[}\PY{l+m+mi}{0}\PY{p}{]}\PY{o}{.}\PY{n}{set\PYZus{}title}\PY{p}{(}\PY{l+s+s2}{\PYZdq{}}\PY{l+s+s2}{Monthly Simple Average Returns}\PY{l+s+s2}{\PYZdq{}}\PY{p}{)}
\PY{n}{axes}\PY{p}{[}\PY{l+m+mi}{1}\PY{p}{]}\PY{o}{.}\PY{n}{hist}\PY{p}{(}\PY{n}{merged\PYZus{}data}\PY{p}{[}\PY{l+s+s2}{\PYZdq{}}\PY{l+s+s2}{Simple Average Return}\PY{l+s+s2}{\PYZdq{}}\PY{p}{]}\PY{p}{,} \PY{n}{density}  \PY{o}{=} \PY{k+kc}{True}\PY{p}{)}
\PY{n}{axes}\PY{p}{[}\PY{l+m+mi}{1}\PY{p}{]}\PY{o}{.}\PY{n}{set\PYZus{}title}\PY{p}{(}\PY{l+s+s2}{\PYZdq{}}\PY{l+s+s2}{Empirical Density of Monthly Average Returns}\PY{l+s+s2}{\PYZdq{}}\PY{p}{)}
\PY{n}{plt}\PY{o}{.}\PY{n}{show}\PY{p}{(}\PY{p}{)}

\PY{n}{fig}\PY{p}{,} \PY{n}{axes} \PY{o}{=} \PY{n}{plt}\PY{o}{.}\PY{n}{subplots}\PY{p}{(}\PY{l+m+mi}{2}\PY{p}{,} \PY{n+nb}{len}\PY{p}{(}\PY{n}{strikes}\PY{p}{)}\PY{p}{,} \PY{n}{figsize}\PY{o}{=}\PY{p}{(}\PY{l+m+mi}{5}\PY{o}{*} \PY{n+nb}{len}\PY{p}{(}\PY{n}{strikes}\PY{p}{)}\PY{p}{,} \PY{l+m+mi}{10} \PY{p}{)}\PY{p}{)}

\PY{k}{for} \PY{n}{i} \PY{o+ow}{in} \PY{n+nb}{range}\PY{p}{(}\PY{n+nb}{len}\PY{p}{(}\PY{n}{strikes}\PY{p}{)}\PY{p}{)}\PY{p}{:}
    \PY{n}{k} \PY{o}{=} \PY{n}{strikes}\PY{p}{[}\PY{n}{i}\PY{p}{]}
    \PY{n}{axes}\PY{p}{[}\PY{l+m+mi}{0}\PY{p}{]}\PY{p}{[}\PY{n}{i}\PY{p}{]}\PY{o}{.}\PY{n}{plot}\PY{p}{(}\PY{n}{np}\PY{o}{.}\PY{n}{maximum}\PY{p}{(}\PY{n}{merged\PYZus{}data}\PY{p}{[}\PY{l+s+s2}{\PYZdq{}}\PY{l+s+s2}{Simple Average Return}\PY{l+s+s2}{\PYZdq{}}\PY{p}{]} \PY{o}{\PYZhy{}} \PY{n}{k}\PY{p}{,} \PY{l+m+mi}{0}\PY{p}{)}\PY{p}{)}
    \PY{n}{axes}\PY{p}{[}\PY{l+m+mi}{0}\PY{p}{]}\PY{p}{[}\PY{n}{i}\PY{p}{]}\PY{o}{.}\PY{n}{set\PYZus{}title}\PY{p}{(}\PY{l+s+s2}{\PYZdq{}}\PY{l+s+s2}{Option Payoff \PYZhy{} Strike: }\PY{l+s+s2}{\PYZdq{}}\PY{o}{+}\PY{n+nb}{str}\PY{p}{(}\PY{n}{k}\PY{p}{)}\PY{p}{)}
    \PY{n}{axes}\PY{p}{[}\PY{l+m+mi}{1}\PY{p}{]}\PY{p}{[}\PY{n}{i}\PY{p}{]}\PY{o}{.}\PY{n}{hist}\PY{p}{(}\PY{n}{np}\PY{o}{.}\PY{n}{maximum}\PY{p}{(}\PY{n}{merged\PYZus{}data}\PY{p}{[}\PY{l+s+s2}{\PYZdq{}}\PY{l+s+s2}{Simple Average Return}\PY{l+s+s2}{\PYZdq{}}\PY{p}{]} \PY{o}{\PYZhy{}} \PY{n}{k}\PY{p}{,} \PY{l+m+mi}{0}\PY{p}{)}\PY{p}{,} \PY{n}{density} \PY{o}{=} \PY{k+kc}{True}\PY{p}{)}
    \PY{n}{axes}\PY{p}{[}\PY{l+m+mi}{1}\PY{p}{]}\PY{p}{[}\PY{n}{i}\PY{p}{]}\PY{o}{.}\PY{n}{set\PYZus{}title}\PY{p}{(}\PY{l+s+s2}{\PYZdq{}}\PY{l+s+s2}{Density of Payoffs\PYZhy{} Strike: }\PY{l+s+s2}{\PYZdq{}}\PY{o}{+}\PY{n+nb}{str}\PY{p}{(}\PY{n}{k}\PY{p}{)}\PY{p}{)}
\end{Verbatim}
\end{tcolorbox}

    \begin{Verbatim}[commandchars=\\\{\}]
Empirical Average Simple Return: 0.006013059812587044
    \end{Verbatim}

    
    \begin{Verbatim}[commandchars=\\\{\}]
        Historical Avg. Payoff
Strike                        
0.01                  0.013428
0.02                  0.008964
0.03                  0.005610
0.04                  0.003312
0.05                  0.001880
    \end{Verbatim}

    
    \begin{center}
    \adjustimage{max size={0.9\linewidth}{0.9\paperheight}}{program_files/program_45_2.png}
    \end{center}
    { \hspace*{\fill} \\}
    
    \begin{center}
    \adjustimage{max size={0.9\linewidth}{0.9\paperheight}}{program_files/program_45_3.png}
    \end{center}
    { \hspace*{\fill} \\}
    
    \subsection{Conduct Historical
Simulation}\label{conduct-historical-simulation}

Next, we compute the conditional volatility of our log returns. We then
compute 10000 simulations at each month, to estimate the basket option
payoff at time t. We repeat this process assuming different conditional
volatility distributions. We then compare our estimates (red) to the
historical payoffs (blue). The shaded region represents the upper and
lower 5\% quantiles of our forecasted basket returns.

    \begin{tcolorbox}[breakable, size=fbox, boxrule=1pt, pad at break*=1mm,colback=cellbackground, colframe=cellborder]
\prompt{In}{incolor}{18}{\boxspacing}
\begin{Verbatim}[commandchars=\\\{\}]
\PY{n}{forecasts} \PY{o}{=} \PY{p}{\PYZob{}}\PY{p}{\PYZcb{}}
\PY{n}{forecasted\PYZus{}avg\PYZus{}return} \PY{o}{=} \PY{p}{\PYZob{}}\PY{p}{\PYZcb{}}
\PY{n}{forecasted\PYZus{}95p} \PY{o}{=} \PY{p}{\PYZob{}}\PY{p}{\PYZcb{}}
\PY{n}{forecasted\PYZus{}5p} \PY{o}{=} \PY{p}{\PYZob{}}\PY{p}{\PYZcb{}}

\PY{n}{timesteps} \PY{o}{=} \PY{n+nb}{len}\PY{p}{(}\PY{n}{merged\PYZus{}data}\PY{p}{[}\PY{l+s+s2}{\PYZdq{}}\PY{l+s+s2}{Simple Average Return}\PY{l+s+s2}{\PYZdq{}}\PY{p}{]}\PY{p}{)}
\PY{n}{fig}\PY{p}{,} \PY{n}{axes} \PY{o}{=} \PY{n}{plt}\PY{o}{.}\PY{n}{subplots}\PY{p}{(}\PY{l+m+mi}{1}\PY{p}{,} \PY{l+m+mi}{3}\PY{p}{,} \PY{n}{figsize}\PY{o}{=}\PY{p}{(}\PY{l+m+mi}{5} \PY{o}{*} \PY{l+m+mi}{3}\PY{p}{,} \PY{l+m+mi}{5}\PY{p}{)}\PY{p}{)}

\PY{k}{for} \PY{n}{j} \PY{o+ow}{in} \PY{n+nb}{range}\PY{p}{(}\PY{n+nb}{len}\PY{p}{(}\PY{n}{distributions}\PY{p}{)}\PY{p}{)}\PY{p}{:}
    \PY{n}{dist} \PY{o}{=} \PY{n}{distributions}\PY{p}{[}\PY{n}{j}\PY{p}{]}
    \PY{n}{forecasts}\PY{p}{[}\PY{n}{dist}\PY{p}{]} \PY{o}{=} \PY{p}{[}\PY{p}{]}
    \PY{n}{forecasted\PYZus{}avg\PYZus{}return}\PY{p}{[}\PY{n}{dist}\PY{p}{]} \PY{o}{=} \PY{n}{np}\PY{o}{.}\PY{n}{empty}\PY{p}{(}\PY{n}{timesteps}\PY{p}{)}
    \PY{n}{forecasted\PYZus{}95p}\PY{p}{[}\PY{n}{dist}\PY{p}{]} \PY{o}{=} \PY{n}{np}\PY{o}{.}\PY{n}{empty}\PY{p}{(}\PY{n}{timesteps}\PY{p}{)}
    \PY{n}{forecasted\PYZus{}5p}\PY{p}{[}\PY{n}{dist}\PY{p}{]} \PY{o}{=} \PY{n}{np}\PY{o}{.}\PY{n}{empty}\PY{p}{(}\PY{n}{timesteps}\PY{p}{)}

    \PY{k}{for} \PY{n}{i} \PY{o+ow}{in} \PY{n+nb}{range}\PY{p}{(}\PY{n}{timesteps}\PY{p}{)}\PY{p}{:}
        \PY{n}{forecasts}\PY{p}{[}\PY{n}{dist}\PY{p}{]}\PY{o}{.}\PY{n}{append}\PY{p}{(}\PY{n}{np}\PY{o}{.}\PY{n}{exp}\PY{p}{(}\PY{n}{compute\PYZus{}forecast}\PY{p}{(}\PY{n}{dist}\PY{p}{,}\PY{n}{i}\PY{p}{,}\PY{l+m+mi}{3000}\PY{p}{)}\PY{p}{)} \PY{o}{\PYZhy{}} \PY{l+m+mi}{1}\PY{p}{)}
        \PY{n}{forecasted\PYZus{}avg\PYZus{}return}\PY{p}{[}\PY{n}{dist}\PY{p}{]}\PY{p}{[}\PY{n}{i}\PY{p}{]} \PY{o}{=} \PY{n}{forecasts}\PY{p}{[}\PY{n}{dist}\PY{p}{]}\PY{p}{[}\PY{n}{i}\PY{p}{]}\PY{o}{.}\PY{n}{mean}\PY{p}{(}\PY{n}{axis}\PY{o}{=}\PY{k+kc}{None}\PY{p}{)}
        \PY{n}{forecasted\PYZus{}95p}\PY{p}{[}\PY{n}{dist}\PY{p}{]}\PY{p}{[}\PY{n}{i}\PY{p}{]} \PY{o}{=} \PY{n}{np}\PY{o}{.}\PY{n}{quantile}\PY{p}{(}\PY{n}{forecasts}\PY{p}{[}\PY{n}{dist}\PY{p}{]}\PY{p}{[}\PY{n}{i}\PY{p}{]}\PY{p}{,}\PY{l+m+mf}{0.975}\PY{p}{)}
        \PY{n}{forecasted\PYZus{}5p}\PY{p}{[}\PY{n}{dist}\PY{p}{]}\PY{p}{[}\PY{n}{i}\PY{p}{]} \PY{o}{=} \PY{n}{np}\PY{o}{.}\PY{n}{quantile}\PY{p}{(}\PY{n}{forecasts}\PY{p}{[}\PY{n}{dist}\PY{p}{]}\PY{p}{[}\PY{n}{i}\PY{p}{]}\PY{p}{,}\PY{l+m+mf}{0.025}\PY{p}{)}

    \PY{n}{outside\PYZus{}upper\PYZus{}bounds} \PY{o}{=} \PY{n}{merged\PYZus{}data}\PY{p}{[}\PY{l+s+s2}{\PYZdq{}}\PY{l+s+s2}{Simple Average Return}\PY{l+s+s2}{\PYZdq{}}\PY{p}{]} \PY{o}{\PYZgt{}} \PY{n}{forecasted\PYZus{}95p}\PY{p}{[}\PY{n}{dist}\PY{p}{]}
    \PY{n}{outside\PYZus{}lower\PYZus{}bounds} \PY{o}{=} \PY{n}{merged\PYZus{}data}\PY{p}{[}\PY{l+s+s2}{\PYZdq{}}\PY{l+s+s2}{Simple Average Return}\PY{l+s+s2}{\PYZdq{}}\PY{p}{]} \PY{o}{\PYZlt{}} \PY{n}{forecasted\PYZus{}5p}\PY{p}{[}\PY{n}{dist}\PY{p}{]}
    \PY{n}{percent\PYZus{}outside\PYZus{}bounds} \PY{o}{=} \PY{p}{(}\PY{n+nb}{sum}\PY{p}{(}\PY{n}{outside\PYZus{}upper\PYZus{}bounds}\PY{p}{)} \PY{o}{+}\PY{n+nb}{sum}\PY{p}{(}\PY{n}{outside\PYZus{}lower\PYZus{}bounds}\PY{p}{)}\PY{p}{)}\PY{o}{/}\PY{n}{timesteps}

    \PY{n+nb}{print}\PY{p}{(}\PY{l+s+s2}{\PYZdq{}}\PY{l+s+s2}{Within Bounds: }\PY{l+s+s2}{\PYZdq{}}\PY{p}{,}\PY{n}{end}\PY{o}{=}\PY{l+s+s2}{\PYZdq{}}\PY{l+s+s2}{\PYZdq{}}\PY{p}{)}    
    \PY{n+nb}{print}\PY{p}{(}\PY{l+m+mi}{1} \PY{o}{\PYZhy{}} \PY{n}{percent\PYZus{}outside\PYZus{}bounds}\PY{p}{)}
    \PY{k}{if} \PY{n}{percent\PYZus{}outside\PYZus{}bounds} \PY{o}{\PYZgt{}} \PY{l+m+mi}{0}\PY{p}{:}
        \PY{n+nb}{print}\PY{p}{(}\PY{l+s+s2}{\PYZdq{}}\PY{l+s+s2}{Above Bounds:}\PY{l+s+s2}{\PYZdq{}}\PY{p}{,}\PY{p}{(}\PY{n}{merged\PYZus{}data}\PY{p}{[}\PY{l+s+s2}{\PYZdq{}}\PY{l+s+s2}{Simple Average Return}\PY{l+s+s2}{\PYZdq{}}\PY{p}{]}\PY{o}{.}\PY{n}{index}\PY{p}{[}\PY{n}{outside\PYZus{}upper\PYZus{}bounds}\PY{p}{]}\PY{o}{.}\PY{n}{date}\PY{o}{.}\PY{n}{astype}\PY{p}{(}\PY{n+nb}{str}\PY{p}{)}\PY{p}{)}\PY{p}{)}
        \PY{n+nb}{print}\PY{p}{(}\PY{l+s+s2}{\PYZdq{}}\PY{l+s+s2}{Below Bounds:}\PY{l+s+s2}{\PYZdq{}}\PY{p}{,}\PY{p}{(}\PY{n}{merged\PYZus{}data}\PY{p}{[}\PY{l+s+s2}{\PYZdq{}}\PY{l+s+s2}{Simple Average Return}\PY{l+s+s2}{\PYZdq{}}\PY{p}{]}\PY{o}{.}\PY{n}{index}\PY{p}{[}\PY{n}{outside\PYZus{}lower\PYZus{}bounds}\PY{p}{]}\PY{o}{.}\PY{n}{date}\PY{o}{.}\PY{n}{astype}\PY{p}{(}\PY{n+nb}{str}\PY{p}{)}\PY{p}{)}\PY{p}{)}

    \PY{n}{axes}\PY{p}{[}\PY{n}{j}\PY{p}{]}\PY{o}{.}\PY{n}{plot}\PY{p}{(}\PY{n}{merged\PYZus{}data}\PY{p}{[}\PY{l+s+s2}{\PYZdq{}}\PY{l+s+s2}{Simple Average Return}\PY{l+s+s2}{\PYZdq{}}\PY{p}{]}\PY{o}{.}\PY{n}{index}\PY{p}{,}\PY{n}{forecasted\PYZus{}avg\PYZus{}return}\PY{p}{[}\PY{n}{dist}\PY{p}{]}\PY{p}{,} \PY{n}{color} \PY{o}{=} \PY{l+s+s2}{\PYZdq{}}\PY{l+s+s2}{red}\PY{l+s+s2}{\PYZdq{}}\PY{p}{)}
    \PY{n}{axes}\PY{p}{[}\PY{n}{j}\PY{p}{]}\PY{o}{.}\PY{n}{plot}\PY{p}{(}\PY{n}{merged\PYZus{}data}\PY{p}{[}\PY{l+s+s2}{\PYZdq{}}\PY{l+s+s2}{Simple Average Return}\PY{l+s+s2}{\PYZdq{}}\PY{p}{]}\PY{o}{.}\PY{n}{index}\PY{p}{,}\PY{n}{merged\PYZus{}data}\PY{p}{[}\PY{l+s+s2}{\PYZdq{}}\PY{l+s+s2}{Simple Average Return}\PY{l+s+s2}{\PYZdq{}}\PY{p}{]}\PY{p}{)}
    \PY{n}{axes}\PY{p}{[}\PY{n}{j}\PY{p}{]}\PY{o}{.}\PY{n}{fill\PYZus{}between}\PY{p}{(}\PY{n}{merged\PYZus{}data}\PY{p}{[}\PY{l+s+s2}{\PYZdq{}}\PY{l+s+s2}{Simple Average Return}\PY{l+s+s2}{\PYZdq{}}\PY{p}{]}\PY{o}{.}\PY{n}{index}\PY{p}{,}\PY{n}{forecasted\PYZus{}5p}\PY{p}{[}\PY{n}{dist}\PY{p}{]}\PY{p}{,}\PY{n}{forecasted\PYZus{}95p}\PY{p}{[}\PY{n}{dist}\PY{p}{]}\PY{p}{,}\PY{n}{color} \PY{o}{=} \PY{l+s+s2}{\PYZdq{}}\PY{l+s+s2}{gray}\PY{l+s+s2}{\PYZdq{}}\PY{p}{,} \PY{n}{alpha} \PY{o}{=} \PY{l+m+mf}{0.5}\PY{p}{)}
    \PY{n}{axes}\PY{p}{[}\PY{n}{j}\PY{p}{]}\PY{o}{.}\PY{n}{set\PYZus{}ylim}\PY{p}{(}\PY{o}{\PYZhy{}}\PY{l+m+mf}{0.2}\PY{p}{,}\PY{l+m+mf}{0.25}\PY{p}{)}
    \PY{n}{axes}\PY{p}{[}\PY{n}{j}\PY{p}{]}\PY{o}{.}\PY{n}{set\PYZus{}title}\PY{p}{(}\PY{n}{dist}\PY{p}{)}
\PY{n}{plt}\PY{o}{.}\PY{n}{show}\PY{p}{(}\PY{p}{)}
\end{Verbatim}
\end{tcolorbox}

    \begin{Verbatim}[commandchars=\\\{\}]
Within Bounds: 0.9714285714285714
Above Bounds: ['2020-11-30']
Below Bounds: ['1998-08-31' '2001-09-30' '2002-09-30' '2008-01-31' '2008-09-30'
 '2008-10-31' '2011-08-31' '2020-02-29' '2020-03-31' '2022-06-30']
Within Bounds: 0.9818181818181818
Above Bounds: []
Below Bounds: ['1998-08-31' '2008-01-31' '2008-09-30' '2008-10-31' '2011-08-31'
 '2020-02-29' '2020-03-31']
Within Bounds: 0.9766233766233766
Above Bounds: ['1999-12-31' '2020-11-30']
Below Bounds: ['1998-08-31' '2008-01-31' '2008-09-30' '2008-10-31' '2011-08-31'
 '2020-02-29' '2020-03-31']
    \end{Verbatim}

    \begin{center}
    \adjustimage{max size={0.9\linewidth}{0.9\paperheight}}{program_files/program_47_1.png}
    \end{center}
    { \hspace*{\fill} \\}
    
    Our models fail to accurately model the returns of the basket. This is
expected, as we assumed a constant mean for each model, and have created
forecasts by computing the average of our simulations, which are
centered about the assumed mean. Our forecasts deviate from our assumed
mean only slightly, unlike real returns.

However, by excluding the upper and lower 5\% quantiles, we can create
bounds on our return data, allowing us to forecast, with some
confidence, the more extreme scenarios. Caution should be exercised
here: our model was not able to predict the start of some of the most
extreme shocks, including the 1998 Russian Financial Crisis (August,
1998), the 2008 Global Financial Crisis (September, 2008), and the
COVID-19 pandemic (February, 2020)

    \section{Case Study: Covered Call
Strategy}\label{case-study-covered-call-strategy}

    Finally, we analyze the performance of a covered call strategy, using
the simulated prices and real return data. We begin with \$1, split
equally between our 6 indices. We will sell one basket option per dollar
in our portfolio, with a fixed strike. The proceeds from the option will
be invested at the historical treasury yield. We rebalance at the end of
each month. We repeat for several strikes.

Here, it would be necessary to discount our option prices by the
historical treasury rate. However, since we are also investing the
proceeds from selling the option at the treasury rate, we can skip
discounting in the first place.

    \begin{tcolorbox}[breakable, size=fbox, boxrule=1pt, pad at break*=1mm,colback=cellbackground, colframe=cellborder]
\prompt{In}{incolor}{20}{\boxspacing}
\begin{Verbatim}[commandchars=\\\{\}]
\PY{n}{avg\PYZus{}return} \PY{o}{=} \PY{p}{(}\PY{n}{merged\PYZus{}data}\PY{p}{[}\PY{n}{tickers}\PY{p}{]}\PY{o}{.}\PY{n}{mean}\PY{p}{(}\PY{n}{axis}\PY{o}{=}\PY{l+m+mi}{1}\PY{p}{)}\PY{p}{)}
\PY{n}{portfolio\PYZus{}value} \PY{o}{=} \PY{p}{\PYZob{}}\PY{p}{\PYZcb{}}
\PY{n}{strikes} \PY{o}{=} \PY{p}{[}\PY{l+m+mi}{0}\PY{p}{,}\PY{l+m+mf}{0.01}\PY{p}{,}\PY{l+m+mf}{0.02}\PY{p}{,}\PY{l+m+mf}{0.03}\PY{p}{,}\PY{l+m+mf}{0.04}\PY{p}{,}\PY{l+m+mf}{0.05}\PY{p}{]}

\PY{k}{for} \PY{n}{dist} \PY{o+ow}{in} \PY{n}{distributions}\PY{p}{:}
    \PY{n}{portfolio\PYZus{}value}\PY{p}{[}\PY{n}{dist}\PY{p}{]} \PY{o}{=} \PY{n}{np}\PY{o}{.}\PY{n}{ones}\PY{p}{(}\PY{p}{(}\PY{n+nb}{len}\PY{p}{(}\PY{n}{strikes}\PY{p}{)}\PY{p}{,}\PY{l+m+mi}{1}\PY{p}{)}\PY{p}{,}\PY{n}{dtype}\PY{o}{=}\PY{n+nb}{float}\PY{p}{)}

    \PY{k}{for} \PY{n}{i} \PY{o+ow}{in} \PY{n+nb}{range}\PY{p}{(}\PY{n+nb}{len}\PY{p}{(}\PY{n}{merged\PYZus{}data}\PY{p}{)}\PY{o}{\PYZhy{}}\PY{l+m+mi}{1}\PY{p}{)}\PY{p}{:}
        \PY{n}{forecasts} \PY{o}{=} \PY{n}{compute\PYZus{}forecast}\PY{p}{(}\PY{n}{dist}\PY{p}{,}\PY{n}{i} \PY{p}{)}
        \PY{n}{forecast\PYZus{}dfs}\PY{p}{[}\PY{n}{dist}\PY{p}{]} \PY{o}{=} \PY{n}{np}\PY{o}{.}\PY{n}{exp}\PY{p}{(}\PY{n}{pd}\PY{o}{.}\PY{n}{DataFrame}\PY{p}{(}\PY{n}{forecasts}\PY{p}{)}\PY{p}{)} \PY{o}{\PYZhy{}} \PY{l+m+mi}{1} \PY{c+c1}{\PYZsh{}convert to simple returns for computing payoff}
        \PY{c+c1}{\PYZsh{}Estimate basket returns}
        \PY{n}{forecast\PYZus{}dfs}\PY{p}{[}\PY{n}{dist}\PY{p}{]}\PY{p}{[}\PY{l+s+s2}{\PYZdq{}}\PY{l+s+s2}{Average}\PY{l+s+s2}{\PYZdq{}}\PY{p}{]} \PY{o}{=} \PY{n}{forecast\PYZus{}dfs}\PY{p}{[}\PY{n}{dist}\PY{p}{]}\PY{o}{.}\PY{n}{mean}\PY{p}{(}\PY{n}{axis}\PY{o}{=}\PY{l+m+mi}{1}\PY{p}{)} 

        \PY{n}{cur\PYZus{}value} \PY{o}{=} \PY{n}{portfolio\PYZus{}value}\PY{p}{[}\PY{n}{dist}\PY{p}{]}\PY{p}{[}\PY{p}{:}\PY{p}{,}\PY{o}{\PYZhy{}}\PY{l+m+mi}{1}\PY{p}{]}
        \PY{n}{new\PYZus{}value} \PY{o}{=} \PY{n}{np}\PY{o}{.}\PY{n}{zeros}\PY{p}{(}\PY{p}{(}\PY{n+nb}{len}\PY{p}{(}\PY{n}{strikes}\PY{p}{)}\PY{p}{,}\PY{l+m+mi}{1}\PY{p}{)}\PY{p}{,}\PY{n}{dtype}\PY{o}{=}\PY{n+nb}{float}\PY{p}{)}

        \PY{c+c1}{\PYZsh{}Compute simulated payoffs}
        \PY{k}{for} \PY{n}{j} \PY{o+ow}{in} \PY{n+nb}{range}\PY{p}{(}\PY{n+nb}{len}\PY{p}{(}\PY{n}{strikes}\PY{p}{)}\PY{p}{)}\PY{p}{:} 
            \PY{n}{k} \PY{o}{=} \PY{n}{strikes}\PY{p}{[}\PY{n}{j}\PY{p}{]}
            \PY{n}{simulated\PYZus{}prices}\PY{o}{.}\PY{n}{loc}\PY{p}{[}\PY{n}{k}\PY{p}{,}\PY{n}{dist}\PY{p}{]} \PY{o}{=} \PY{n}{np}\PY{o}{.}\PY{n}{maximum}\PY{p}{(}\PY{n}{forecast\PYZus{}dfs}\PY{p}{[}\PY{n}{dist}\PY{p}{]}\PY{p}{[}\PY{l+s+s2}{\PYZdq{}}\PY{l+s+s2}{Average}\PY{l+s+s2}{\PYZdq{}}\PY{p}{]} \PY{o}{\PYZhy{}} \PY{n}{k}\PY{p}{,}\PY{l+m+mi}{0}\PY{p}{)}\PY{o}{.}\PY{n}{mean}\PY{p}{(}\PY{p}{)}
            \PY{k}{if} \PY{n}{avg\PYZus{}return}\PY{o}{.}\PY{n}{iloc}\PY{p}{[}\PY{n}{i}\PY{p}{]} \PY{o}{\PYZgt{}} \PY{n}{k}\PY{p}{:}
                \PY{n}{new\PYZus{}value}\PY{p}{[}\PY{n}{j}\PY{p}{]} \PY{o}{=} \PY{n}{cur\PYZus{}value}\PY{p}{[}\PY{n}{j}\PY{p}{]}\PY{o}{*}\PY{p}{(}\PY{l+m+mi}{1} \PY{o}{+} \PY{n}{k}\PY{p}{)} \PY{o}{+} \PY{n}{simulated\PYZus{}prices}\PY{o}{.}\PY{n}{loc}\PY{p}{[}\PY{n}{k}\PY{p}{,}\PY{n}{dist}\PY{p}{]}\PY{o}{*}\PY{n}{cur\PYZus{}value}\PY{p}{[}\PY{n}{j}\PY{p}{]}
            \PY{k}{else}\PY{p}{:}
                \PY{n}{new\PYZus{}value}\PY{p}{[}\PY{n}{j}\PY{p}{]} \PY{o}{=} \PY{n}{cur\PYZus{}value}\PY{p}{[}\PY{n}{j}\PY{p}{]}\PY{o}{*}\PY{p}{(}\PY{l+m+mi}{1}\PY{o}{+}\PY{n}{avg\PYZus{}return}\PY{o}{.}\PY{n}{iloc}\PY{p}{[}\PY{n}{i}\PY{p}{]}\PY{p}{)} \PY{o}{+} \PY{n}{simulated\PYZus{}prices}\PY{o}{.}\PY{n}{loc}\PY{p}{[}\PY{n}{k}\PY{p}{,}\PY{n}{dist}\PY{p}{]}\PY{o}{*}\PY{n}{cur\PYZus{}value}\PY{p}{[}\PY{n}{j}\PY{p}{]}
        \PY{n}{portfolio\PYZus{}value}\PY{p}{[}\PY{n}{dist}\PY{p}{]} \PY{o}{=} \PY{n}{np}\PY{o}{.}\PY{n}{append}\PY{p}{(}\PY{n}{portfolio\PYZus{}value}\PY{p}{[}\PY{n}{dist}\PY{p}{]}\PY{p}{,}\PY{n}{new\PYZus{}value}\PY{p}{,}\PY{n}{axis}\PY{o}{=}\PY{l+m+mi}{1}\PY{p}{)} 
\end{Verbatim}
\end{tcolorbox}

    \begin{tcolorbox}[breakable, size=fbox, boxrule=1pt, pad at break*=1mm,colback=cellbackground, colframe=cellborder]
\prompt{In}{incolor}{21}{\boxspacing}
\begin{Verbatim}[commandchars=\\\{\}]
\PY{n}{fig}\PY{p}{,} \PY{n}{axes} \PY{o}{=} \PY{n}{plt}\PY{o}{.}\PY{n}{subplots}\PY{p}{(}\PY{l+m+mi}{3}\PY{p}{,} \PY{n+nb}{len}\PY{p}{(}\PY{n}{strikes}\PY{p}{)}\PY{p}{,} \PY{n}{figsize}\PY{o}{=}\PY{p}{(}\PY{l+m+mi}{5} \PY{o}{*} \PY{n+nb}{len}\PY{p}{(}\PY{n}{strikes}\PY{p}{)}\PY{p}{,} \PY{l+m+mi}{10}\PY{p}{)}\PY{p}{)}
\PY{k}{for} \PY{n}{i} \PY{o+ow}{in} \PY{n+nb}{range}\PY{p}{(}\PY{n+nb}{len}\PY{p}{(}\PY{n}{distributions}\PY{p}{)}\PY{p}{)}\PY{p}{:}
    \PY{n}{dist} \PY{o}{=} \PY{n}{distributions}\PY{p}{[}\PY{n}{i}\PY{p}{]}
    \PY{k}{for} \PY{n}{j} \PY{o+ow}{in} \PY{n+nb}{range}\PY{p}{(}\PY{n+nb}{len}\PY{p}{(}\PY{n}{strikes}\PY{p}{)}\PY{p}{)}\PY{p}{:}
        \PY{n}{strike} \PY{o}{=} \PY{n}{strikes}\PY{p}{[}\PY{n}{j}\PY{p}{]}
        \PY{n}{axes}\PY{p}{[}\PY{n}{i}\PY{p}{]}\PY{p}{[}\PY{n}{j}\PY{p}{]}\PY{o}{.}\PY{n}{plot}\PY{p}{(}\PY{n}{merged\PYZus{}data}\PY{p}{[}\PY{n}{tickers}\PY{p}{]}\PY{o}{.}\PY{n}{index}\PY{p}{,}\PY{n}{portfolio\PYZus{}value}\PY{p}{[}\PY{n}{dist}\PY{p}{]}\PY{p}{[}\PY{n}{j}\PY{p}{]}\PY{p}{)}
        \PY{n}{axes}\PY{p}{[}\PY{n}{i}\PY{p}{]}\PY{p}{[}\PY{n}{j}\PY{p}{]}\PY{o}{.}\PY{n}{set\PYZus{}title}\PY{p}{(}\PY{l+s+s2}{\PYZdq{}}\PY{l+s+s2}{Portfolio Growth \PYZhy{} GARCH dist: }\PY{l+s+s2}{\PYZdq{}}\PY{o}{+}\PY{n}{dist}\PY{o}{+}\PY{l+s+s2}{\PYZdq{}}\PY{l+s+s2}{ \PYZhy{} Strike: }\PY{l+s+s2}{\PYZdq{}}\PY{o}{+}\PY{n+nb}{str}\PY{p}{(}\PY{n}{strike}\PY{p}{)}\PY{p}{)}
\PY{n}{plt}\PY{o}{.}\PY{n}{tight\PYZus{}layout}\PY{p}{(}\PY{p}{)}
\end{Verbatim}
\end{tcolorbox}

    \begin{center}
    \adjustimage{max size={0.9\linewidth}{0.9\paperheight}}{program_files/program_52_0.png}
    \end{center}
    { \hspace*{\fill} \\}
    
    From the above graphs, it is clear that this strategy is worth analyzing
more. Let us conclude by analysing the monthly returns, and comparing to
that of our underlying indices.

    \begin{tcolorbox}[breakable, size=fbox, boxrule=1pt, pad at break*=1mm,colback=cellbackground, colframe=cellborder]
\prompt{In}{incolor}{59}{\boxspacing}
\begin{Verbatim}[commandchars=\\\{\}]
\PY{n}{portfolio\PYZus{}returns} \PY{o}{=} \PY{p}{\PYZob{}}\PY{p}{\PYZcb{}}

\PY{k}{for} \PY{n}{dist} \PY{o+ow}{in} \PY{n}{distributions}\PY{p}{:}
    \PY{n}{values}  \PY{o}{=} \PY{n}{pd}\PY{o}{.}\PY{n}{DataFrame}\PY{p}{(}\PY{n}{portfolio\PYZus{}value}\PY{p}{[}\PY{n}{dist}\PY{p}{]}\PY{o}{.}\PY{n}{T}\PY{p}{,}\PY{n}{index} \PY{o}{=} \PY{n}{merged\PYZus{}data}\PY{p}{[}\PY{n}{tickers}\PY{p}{]}\PY{o}{.}\PY{n}{index}\PY{p}{,} \PY{n}{columns} \PY{o}{=} \PY{n}{strikes}\PY{p}{)}
    \PY{n}{returns} \PY{o}{=} \PY{n}{pd}\PY{o}{.}\PY{n}{DataFrame}\PY{p}{(}\PY{n}{np}\PY{o}{.}\PY{n}{log}\PY{p}{(}\PY{n}{values}\PY{o}{.}\PY{n}{pct\PYZus{}change}\PY{p}{(}\PY{p}{)}\PY{o}{+}\PY{l+m+mi}{1}\PY{p}{)}\PY{p}{,}\PY{n}{index} \PY{o}{=} \PY{n}{merged\PYZus{}data}\PY{p}{[}\PY{n}{tickers}\PY{p}{]}\PY{o}{.}\PY{n}{index}\PY{p}{,}\PY{n}{columns} \PY{o}{=} \PY{n}{strikes}\PY{p}{)}
    \PY{n}{returns} \PY{o}{=} \PY{n}{returns}\PY{o}{.}\PY{n}{dropna}\PY{p}{(}\PY{p}{)}

    \PY{n}{results\PYZus{}df} \PY{o}{=} \PY{n}{pd}\PY{o}{.}\PY{n}{DataFrame}\PY{p}{(}\PY{n}{index} \PY{o}{=} \PY{p}{[}\PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{mu}\PY{l+s+s1}{\PYZsq{}}\PY{p}{,}\PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{sigma}\PY{l+s+s1}{\PYZsq{}}\PY{p}{,}\PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{VaR95}\PY{l+s+s1}{\PYZsq{}}\PY{p}{,}\PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{ES95}\PY{l+s+s1}{\PYZsq{}}\PY{p}{]}\PY{p}{,} \PY{n}{columns} \PY{o}{=} \PY{n}{strikes}\PY{p}{)}
    \PY{n}{results\PYZus{}df}\PY{p}{[}\PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{benchmark}\PY{l+s+s1}{\PYZsq{}}\PY{p}{]} \PY{o}{=} \PY{n}{np}\PY{o}{.}\PY{n}{round}\PY{p}{(}\PY{n}{np}\PY{o}{.}\PY{n}{array}\PY{p}{(}\PY{p}{[}\PY{n}{avg\PYZus{}return}\PY{o}{.}\PY{n}{mean}\PY{p}{(}\PY{p}{)}\PY{p}{,}
                                        \PY{n}{avg\PYZus{}return}\PY{o}{.}\PY{n}{std}\PY{p}{(}\PY{p}{)}\PY{p}{,}
                                    \PY{n}{np}\PY{o}{.}\PY{n}{quantile}\PY{p}{(}\PY{n}{avg\PYZus{}return}\PY{p}{,}\PY{l+m+mf}{0.05}\PY{p}{)}\PY{p}{,} 
                                    \PY{n}{avg\PYZus{}return}\PY{p}{[}\PY{n}{avg\PYZus{}return}\PY{o}{\PYZlt{}}\PY{n}{np}\PY{o}{.}\PY{n}{quantile}\PY{p}{(}\PY{n}{avg\PYZus{}return}\PY{p}{,}\PY{l+m+mf}{0.05}\PY{p}{)}\PY{p}{]}\PY{o}{.}\PY{n}{mean}\PY{p}{(}\PY{p}{)}\PY{p}{]}\PY{p}{)}\PY{p}{,}\PY{l+m+mi}{5}\PY{p}{)}

    \PY{k}{for} \PY{n}{k} \PY{o+ow}{in} \PY{n}{strikes}\PY{p}{:}
        \PY{n}{results\PYZus{}df}\PY{o}{.}\PY{n}{loc}\PY{p}{[}\PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{mu}\PY{l+s+s1}{\PYZsq{}}\PY{p}{,}\PY{n}{k}\PY{p}{]} \PY{o}{=} \PY{n+nb}{round}\PY{p}{(}\PY{n}{returns}\PY{p}{[}\PY{n}{k}\PY{p}{]}\PY{o}{.}\PY{n}{mean}\PY{p}{(}\PY{p}{)}\PY{p}{,}\PY{l+m+mi}{5}\PY{p}{)}
        \PY{n}{results\PYZus{}df}\PY{o}{.}\PY{n}{loc}\PY{p}{[}\PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{sigma}\PY{l+s+s1}{\PYZsq{}}\PY{p}{,}\PY{n}{k}\PY{p}{]} \PY{o}{=} \PY{n+nb}{round}\PY{p}{(}\PY{n}{returns}\PY{p}{[}\PY{n}{k}\PY{p}{]}\PY{o}{.}\PY{n}{std}\PY{p}{(}\PY{p}{)}\PY{p}{,}\PY{l+m+mi}{5}\PY{p}{)}
        \PY{n}{results\PYZus{}df}\PY{o}{.}\PY{n}{loc}\PY{p}{[}\PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{VaR95}\PY{l+s+s1}{\PYZsq{}}\PY{p}{,}\PY{n}{k}\PY{p}{]} \PY{o}{=} \PY{n+nb}{round}\PY{p}{(}\PY{n}{np}\PY{o}{.}\PY{n}{quantile}\PY{p}{(}\PY{n}{returns}\PY{p}{[}\PY{n}{k}\PY{p}{]}\PY{p}{,} \PY{l+m+mf}{0.05}\PY{p}{)}\PY{p}{,}\PY{l+m+mi}{5}\PY{p}{)}
        \PY{n}{results\PYZus{}df}\PY{o}{.}\PY{n}{loc}\PY{p}{[}\PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{ES95}\PY{l+s+s1}{\PYZsq{}}\PY{p}{,}\PY{n}{k}\PY{p}{]} \PY{o}{=} \PY{n+nb}{round}\PY{p}{(}\PY{n}{returns}\PY{p}{[}\PY{n}{returns}\PY{p}{[}\PY{n}{k}\PY{p}{]} \PY{o}{\PYZlt{}}\PY{o}{=} \PY{n}{results\PYZus{}df}\PY{o}{.}\PY{n}{loc}\PY{p}{[}\PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{VaR95}\PY{l+s+s1}{\PYZsq{}}\PY{p}{,}\PY{n}{k}\PY{p}{]}\PY{p}{]}\PY{p}{[}\PY{n}{k}\PY{p}{]}\PY{o}{.}\PY{n}{mean}\PY{p}{(}\PY{p}{)}\PY{p}{,}\PY{l+m+mi}{5}\PY{p}{)}
        \PY{n}{t\PYZus{}stat}\PY{p}{,} \PY{n}{p\PYZus{}value} \PY{o}{=} \PY{n}{ttest\PYZus{}ind}\PY{p}{(}\PY{n}{returns}\PY{p}{[}\PY{n}{k}\PY{p}{]}\PY{p}{,} \PY{n}{avg\PYZus{}return}\PY{p}{)}
        \PY{n}{results\PYZus{}df}\PY{o}{.}\PY{n}{loc}\PY{p}{[}\PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{p\PYZhy{}value}\PY{l+s+s1}{\PYZsq{}}\PY{p}{,}\PY{n}{k}\PY{p}{]} \PY{o}{=} \PY{n+nb}{round}\PY{p}{(}\PY{n}{p\PYZus{}value}\PY{o}{/}\PY{l+m+mi}{2}\PY{p}{,}\PY{l+m+mi}{5}\PY{p}{)} \PY{k}{if} \PY{n}{t\PYZus{}stat} \PY{o}{\PYZgt{}}\PY{l+m+mi}{0}  \PY{k}{else} \PY{l+m+mi}{1}
    \PY{n}{results\PYZus{}df} \PY{o}{=} \PY{n}{results\PYZus{}df}\PY{o}{.}\PY{n}{round}\PY{p}{(}\PY{l+m+mi}{5}\PY{p}{)}

    \PY{n+nb}{print}\PY{p}{(}\PY{l+s+s2}{\PYZdq{}}\PY{l+s+s2}{GARCH Dist:}\PY{l+s+s2}{\PYZdq{}}\PY{p}{,}\PY{n}{dist}\PY{p}{)}

    \PY{n}{display}\PY{p}{(}\PY{n}{results\PYZus{}df}\PY{p}{)}  
\end{Verbatim}
\end{tcolorbox}

    \begin{Verbatim}[commandchars=\\\{\}]
GARCH Dist: normal
    \end{Verbatim}

    
    \begin{Verbatim}[commandchars=\\\{\}]
             0.0     0.01     0.02     0.03     0.04     0.05  benchmark
mu       0.00615  0.00644  0.00656  0.00656  0.00634  0.00594    0.00481
sigma    0.02779  0.03091  0.03387  0.03651  0.03863  0.04012    0.04173
VaR95   -0.05365 -0.05921 -0.06351 -0.06672  -0.0692 -0.07092   -0.07294
ES95    -0.08627 -0.09201 -0.09671 -0.10041 -0.10325 -0.10536   -0.10420
p-value   0.2999  0.26885  0.26098   0.2679  0.29805  0.35096        NaN
    \end{Verbatim}

    
    \begin{Verbatim}[commandchars=\\\{\}]
GARCH Dist: t
    \end{Verbatim}

    
    \begin{Verbatim}[commandchars=\\\{\}]
             0.0     0.01     0.02     0.03     0.04     0.05  benchmark
mu       0.00878  0.00897  0.00893  0.00873  0.00829  0.00764    0.00481
sigma    0.02773  0.03084  0.03379  0.03642  0.03855  0.04004    0.04173
VaR95   -0.05145 -0.05718 -0.06164 -0.06495 -0.06728 -0.06904   -0.07294
ES95    -0.08324 -0.08906 -0.09389 -0.09778 -0.10082 -0.10316   -0.10420
p-value  0.06033  0.05822  0.06611  0.08258  0.11477  0.16839        NaN
    \end{Verbatim}

    
    \begin{Verbatim}[commandchars=\\\{\}]
GARCH Dist: skewt
    \end{Verbatim}

    
    \begin{Verbatim}[commandchars=\\\{\}]
             0.0     0.01     0.02     0.03     0.04     0.05  benchmark
mu       0.00517  0.00518  0.00511  0.00505  0.00494  0.00474    0.00481
sigma    0.02791  0.03105    0.034  0.03664  0.03875  0.04022    0.04173
VaR95    -0.0547 -0.06059   -0.065 -0.06813 -0.07052 -0.07204   -0.07294
ES95    -0.08765 -0.09374 -0.09869 -0.10247 -0.10523 -0.10711   -0.10420
p-value  0.44357  0.44395  0.45672  0.46581  0.48166        1        NaN
    \end{Verbatim}

    
    \subsection{Conclusion}\label{conclusion}

    Regardless of the distribution chosen for our GARCH residuals, we
observed low heteroskedatics effects in our timeseries. We found that
GARCH(1,1) model worked best for all choices of distribution, with a
skewed Student's-t distribution offering the best fit. We found that a
Student's-t copula could be closely fitted to the GARCH residuals,
allowing us to conduct correlated multivariate volatility forecasts.
While these forecasts are not a good indicator of future returns, they
were still useful in pricing our basket options. Our basket options
closely reflected the real world average payoffs. We found that a
covered call strategy, with strike return less than or equal to 3\%,
offered us a greater return than investing equally in the underlying
indices alone, with a lesser volatility, value at risk and expected
shortfall. However, these last conclusions were not statistically
significant.

    \section{References}\label{references}

\begin{enumerate}
\def\labelenumi{\arabic{enumi}.}
\item
  \textbf{Aroussi, R. (n.d.).} Yfinance. PyPI.
  \url{https://pypi.org/project/yfinance/}
\item
  \textbf{Astanin, S. (n.d.).} Tabulate. PyPI.
  \url{https://pypi.org/project/tabulate/}
\item
  \textbf{Cherubini, U., Luciano, E., \& Vecchiato, W. (2004).} Copula
  Methods in Finance. \url{https://doi.org/10.1002/9781118673331}
\item
  \textbf{Hansen, B. E. (1994).} Autoregressive conditional density
  estimation. \emph{International Economic Review, 35}(3), 705.
  \url{https://doi.org/10.2307/2527081}
\item
  \textbf{Harris, C. R., Millman, K. J., van der Walt, S. J., Gommers,
  R., Virtanen, P., Cournapeau, D., Wieser, E., Taylor, J., Berg, S.,
  Smith, N. J., Kern, R., Picus, M., Hoyer, S., van Kerkwijk, M. H.,
  Brett, M., Haldane, A., del Río, J. F., Wiebe, M., Peterson, P.,
  \ldots{} Oliphant, T. E. (2020).} Array programming with NumPy.
  \emph{Nature, 585}(7825), 357--362.
  \url{https://doi.org/10.1038/s41586-020-2649-2}
\item
  \textbf{Hunter, J. D. (2007).} Matplotlib: A 2D graphics environment.
  \emph{Computing in Science \& Engineering, 9}(3), 90--95.
  \url{https://doi.org/10.1109/mcse.2007.55}
\item
  \textbf{The pandas development team. (2024, April 10).}
  Pandas-dev/Pandas: Pandas. Zenodo.
  \url{https://zenodo.org/records/10957263}
\item
  \textbf{Seabold, S., \& Perktold, J. (2010).} Statsmodels: Econometric
  and statistical modeling with python. \emph{Proceedings of the Python
  in Science Conference}, 92--96.
  \url{https://doi.org/10.25080/majora-92bf1922-011}
\item
  \textbf{Sheppard, K., Khrapov, S., Lipták, G., Mikedeltalima,
  Capellini, R., Alejandro-Cermeno, Hugle, Esvhd, bot, S., Fortin, A.,
  Jpn, Judell, M., Russell, R., Li, W., 645775992, Adams, A.,
  Jbrockmendel, Migrator, L., Rabba, M., \ldots{} Çelik, B. (2023,
  September 26).} Bashtage/Arch: Release 6.1.0. Zenodo.
  \url{https://zenodo.org/record/7975104}
\item
  \textbf{Virtanen, P., Gommers, R., Oliphant, T. E., Haberland, M.,
  Reddy, T., Cournapeau, D., Burovski, E., Peterson, P., Weckesser, W.,
  Bright, J., van der Walt, S. J., Brett, M., Wilson, J., Millman, K.
  J., Mayorov, N., Nelson, A. R., Jones, E., Kern, R., Larson, E.,
  \ldots{} Vázquez-Baeza, Y. (2020).} SciPy 1.0: Fundamental algorithms
  for scientific computing in python. \emph{Nature Methods, 17}(3),
  261--272. \url{https://doi.org/10.1038/s41592-019-0686-2}
\end{enumerate}


    % Add a bibliography block to the postdoc
    
    
    
\end{document}
